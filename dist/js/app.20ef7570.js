(function(){"use strict";var e={39453:function(e,t,s){var a=s(20144),n=s(53849),i=s(8129),o=s(65075),r=s(39300),l=s(69256),d=s(87641),c=s(74694),u=function(){var e=this,t=e._self._c;return t(o.Z,[t("app-header"),t(d.Z,{attrs:{"fill-height":""}},[t(l.Z,{attrs:{fluid:""}},[e.alert.message?t(i.Z,{attrs:{tag:"pre",dense:"",outlined:e.alert.outlined,type:e.alert.type}},[e._v(" "+e._s(e.alert.message)+" ")]):e._e(),t("router-view")],1),t(c.Z,{attrs:{timeout:e.snackbar.timeout,outlined:e.snackbar.outlined},model:{value:e.snackbar.show,callback:function(t){e.$set(e.snackbar,"show",t)},expression:"snackbar.show"}},[e._v(" "+e._s(e.snackbar.message)+" "),t(r.Z,{attrs:{color:"blue",text:""},on:{click:function(t){e.snackbar.show=!1}}},[e._v(" Close ")])],1)],1)],1)},m=[],p=s(55550),h=s(44206),f=s(52045),v=s(34980),_=s(13687),b=s(65969),g=s(97953),Z=function(){var e=this,t=e._self._c;return t("div",[t(v.Z,{staticClass:"hidden-md-and-up",attrs:{app:"",absolute:"",temporary:""},model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}},[t("nav-menu",{model:{value:e.headerItems,callback:function(t){e.headerItems=t},expression:"headerItems"}}),t(h.Z),t("nav-menu",{model:{value:e.leftItems,callback:function(t){e.leftItems=t},expression:"leftItems"}})],1),t(b.Z,{attrs:{color:"primary",dark:"",fixed:""}},[t(p.Z,{staticClass:"hidden-md-and-up",on:{click:function(t){t.stopPropagation(),e.drawer=!e.drawer}}}),t(g.qW,{staticClass:"hidden-sm-and-down"},[e._v("Школа")]),t(_.Z),t("header-menu",{staticClass:"hidden-sm-and-down",model:{value:e.headerItems,callback:function(t){e.headerItems=t},expression:"headerItems"}}),t(g.lj,[e.isAuth?[t(r.Z,{attrs:{text:"",to:{name:"main-profile"}}},[e._v(" ЛК ")]),t(r.Z,{attrs:{text:""},on:{click:e.logout}},[t(f.Z,[e._v("mdi-logout")]),e._v(" Выход ")],1)]:t(r.Z,{attrs:{text:"",to:{name:"main-login"}}},[t(f.Z,[e._v("mdi-login")]),e._v(" Вход ")],1)],2)],1)],1)},k=[],x=s(6168),y=s(67779),$=s(89229),w=s(66105),E=s(74611),I=function(){var e=this,t=e._self._c;return t(x.Z,[e._l(e.items,(function(s,a){return[s.items&&s.items.length?[t(y.Z,{key:a,attrs:{"prepend-icon":s.icon,"no-action":""},scopedSlots:e._u([{key:"activator",fn:function(){return[t(w.km,[t(w.V9,{domProps:{textContent:e._s(s.title)}})],1)]},proxy:!0}],null,!0),model:{value:s.active,callback:function(t){e.$set(s,"active",t)},expression:"item.active"}},e._l(s.items,(function(s,a){return t($.Z,{key:a,attrs:{link:"",href:s.href}},[t(w.km,[t(w.V9,[e._v(" "+e._s(s.title)+" "),t(f.Z,{staticClass:"float-right",domProps:{textContent:e._s(s.icon)}})],1)],1)],1)})),1)]:[t($.Z,{key:a,attrs:{link:"",href:s.href}},[t(E.Z,[t(f.Z,{domProps:{textContent:e._s(s.icon)}})],1),t(w.V9,[e._v(" "+e._s(s.title)+" ")])],1)]]}))],2)},C=[],D={model:{prop:"items"},props:{items:{type:Array,default:()=>[]}}},T=D,F=s(1001),P=(0,F.Z)(T,I,C,!1,null,null,null),j=P.exports,O=s(76031),S=function(){var e=this,t=e._self._c;return t(g.lj,[e._l(e.items,(function(s,a){return[s.items?[t(O.Z,{key:a,attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function({on:a,attrs:n}){return[t(r.Z,e._g(e._b({attrs:{text:""}},"v-btn",n,!1),a),[t(f.Z,{attrs:{left:""},domProps:{textContent:e._s(s.icon)}}),e._v(" "+e._s(s.title)+" ")],1)]}}],null,!0)},[t(x.Z,e._l(s.items,(function(s,a){return t($.Z,{key:a,attrs:{to:s.href}},[t(w.V9,[t(f.Z,{attrs:{left:""},domProps:{textContent:e._s(s.icon)}}),e._v(" "+e._s(s.title)+" ")],1)],1)})),1)],1)]:[t(r.Z,{key:a,attrs:{text:"",to:s.href}},[t(f.Z,{attrs:{left:""},domProps:{textContent:e._s(s.icon)}}),e._v(" "+e._s(s.title)+" ")],1)]]}))],2)},A=[],q={model:{prop:"items"},props:{items:{type:Array,default:()=>[]}}},U=q,H=(0,F.Z)(U,S,A,!1,null,null,null),B=H.exports,L={components:{NavMenu:j,HeaderMenu:B},name:"AppHeader",data:()=>({drawer:!1,headerItems:[],leftItems:[]}),mounted(){this.loadLeft(),this.loadHeader()},computed:{isAuth(){return this.$store.getters["authentication/isAuthenticated"]}},methods:{loadLeft(){this.$http.get("/menu/left.php").then(function(e){this.leftItems=e}.bind(this))},loadHeader(){this.$http.get("/menu/header.php").then(function(e){this.headerItems=e}.bind(this))},logout(){const{dispatch:e}=this.$store;e("authentication/logout")}},watch:{$route(){this.loadLeft(),this.loadHeader()}}},N=L,M=(0,F.Z)(N,Z,k,!1,null,"5a5b6b58",null),G=M.exports,W={name:"App",data:()=>({}),computed:{alert(){return this.$store.state.alert},snackbar(){return this.$store.state.snackbar}},watch:{$route(){this.$store.dispatch("alert/clear"),this.$store.dispatch("snackbar/clear")}},components:{AppHeader:G},mounted(){const{dispatch:e}=this.$store;e("authentication/check")}},R=W,Y=(0,F.Z)(R,u,m,!1,null,null,null),V=Y.exports,K=s(11272),Q=s.n(K),z=s(78345),J=s(20629);const X={namespaced:!0,state:{type:null,message:null,outlined:!1},actions:{success({commit:e},t){e("success",t)},info({commit:e},t){e("info",t)},warning({commit:e},t){e("warning",t)},error({commit:e},t){e("error",t)},outlined({commit:e},t){e("outlined",t)},clear({commit:e}){e("clear")}},mutations:{success(e,t){e.type="success",e.message=t},info(e,t){e.type="danger",e.message=t},warning(e,t){e.type="danger",e.message=t},error(e,t){e.type="error",e.message=t},outlined(e,t){e.outlined=t},clear(e){e.type=null,e.message=null,e.outlined=!1}}},ee={namespaced:!0,state:{timeout:5e3,message:null,outlined:!1,show:!1},actions:{message({commit:e},t){e("message",t)},outlined({commit:e},t){e("outlined",t)},clear({commit:e}){e("clear")}},mutations:{message(e,t){e.message=t,e.show=!0},outlined(e,t){e.outlined=t},clear(e){e.message=null,e.outlined=!1,e.show=!1}}};s(57658);var te=s(9669),se=s.n(te),ae=s(12346);const ne=se().create({baseURL:"http://sh67.school/",headers:{}});a["default"].use(ae.Z,ne);var ie=ne;const oe={namespaced:!0,state:{is_authenticated:!1,user:null},actions:{login({dispatch:e,commit:t},{login:s,password:a}){const n=new FormData;return n.append("f","login"),n.append("user[login]",s),n.append("user[password]",a),ie.post("/login.php",n).then((function(e){t("loginSuccess",e)}),(function(s){t("loginFailure",s),e("alert/error",s)}))},check({commit:e,dispatch:t}){const s=new FormData;return s.append("f","check-is-authenticated"),ie.post("/login.php",s).then((function(t){t?e("loginSuccess",t):e("loginFailure")}),(function(s){e("loginFailure",s),t("alert/error",s)}))},logout({commit:e,dispatch:t}){const s=new FormData;return s.append("f","logout"),ie.post("/login.php",s).then((function(){e("logout")}),(function(s){e("loginFailure",s),t("alert/error",s)}))}},mutations:{loginSuccess(e,t){e.is_authenticated=!0,e.user=t,Xs.push(Xs.history.current.query.redirect||"/")},loginFailure(e){e.is_authenticated=!1,e.user=null},logout(e){e.is_authenticated=!1,e.user=null,Xs.push("/")}},getters:{isAuthenticated:e=>"true"===e.is_authenticated||!0===e.is_authenticated,isRoot:e=>"true"===e.user.is_root||!0===e.user.is_root,isClass:e=>"true"===e.user.is_class||!0===e.user.is_class}};a["default"].use(J.ZP);const re=new J.ZP.Store({modules:{alert:X,snackbar:ee,authentication:oe}});var le=re,de=function(){var e=this,t=e._self._c;return t(l.Z,e._l(e.items,(function(s,a){return t(r.Z,{key:a,attrs:{to:{name:"ep-event",params:{id:s.id}}}},[e._v(" "+e._s(s.name)+" ")])})),1)},ce=[],ue={name:"AllCalendars",data:()=>({items:[]}),methods:{load(){const e=new FormData;return e.append("f","list"),this.$http.post("/event/event.php",e).then(function(e){this.items=e}.bind(this))}},mounted(){this.load()}},me=ue,pe=(0,F.Z)(me,de,ce,!1,null,"eb6ffcce",null),he=pe.exports,fe=function(){var e=this;e._self._c;return e._m(0)},ve=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"not-found"},[t("h1",[e._v(" Ничего не найдено ")])])}],_e={name:"NotFound"},be=_e,ge=(0,F.Z)(be,fe,ve,!1,null,"28a367b2",null),Ze=ge.exports,ke=function(){var e=this,t=e._self._c;return t("router-view")},xe=[],ye={components:{}},$e=ye,we=(0,F.Z)($e,ke,xe,!1,null,null,null),Ee=we.exports,Ie=s(60199),Ce=function(){var e=this,t=e._self._c;return t(x.Z,{attrs:{"two-line":"",subheader:""}},[t(Ie.Z,[e._v("General")]),t($.Z,{attrs:{link:"",to:"/main/ou"}},[t(w.km,[t(w.V9,[e._v("Organizational Unit")]),t(w.oZ,[e._v("Представляет собой контейнер, который может содержать различные объекты")])],1)],1),t($.Z,{attrs:{link:"",to:"/main/user"}},[t(w.km,[t(w.V9,[e._v("User")]),t(w.oZ,[e._v("User")])],1)],1),t($.Z,{attrs:{link:"",to:"/main/group"}},[t(w.km,[t(w.V9,[e._v("Group")]),t(w.oZ,[e._v("Group")])],1)],1),t(h.Z)],1)},De=[],Te={name:"MainIndex"},Fe=Te,Pe=(0,F.Z)(Fe,Ce,De,!1,null,"0fb9f763",null),je=Pe.exports,Oe=s(34145),Se=s(54886),Ae=s(5238),qe=s(60266),Ue=s(89014),He=s(24878),Be=s(11713),Le=s(21667),Ne=s(78704),Me=function(){var e=this,t=e._self._c;return t(Ue.Z,{staticClass:"elevation-1",attrs:{dense:"",headers:e.headers,items:e.desserts,"item-key":"code",loading:e.loading,"loading-text":"Loading... Please wait"},scopedSlots:e._u([{key:"top",fn:function(){return[t(b.Z,{attrs:{flat:""}},[t(g.qW,[e._v("Подразделения")]),t(h.Z,{staticClass:"mx-4",attrs:{inset:"",vertical:""}}),t(_.Z),t(r.Z,{attrs:{dark:"",color:"light-blue"},on:{click:e.load}},[e._v(" Обновить "),t(f.Z,{staticClass:"ml-2"},[e._v("mdi-reload")])],1),t(He.Z,{attrs:{"max-width":"500px"},model:{value:e.dialogDelete,callback:function(t){e.dialogDelete=t},expression:"dialogDelete"}},[t(Oe.Z,[t(Se.EB,{staticClass:"text-h5"},[e._v("Are you sure you want to delete this item?")]),t(Se.h7,[t(_.Z),t(r.Z,{attrs:{color:"blue darken-1",text:""},on:{click:e.closeDelete}},[e._v("Cancel")]),t(r.Z,{attrs:{color:"blue darken-1",text:""},on:{click:e.deleteItemConfirm}},[e._v("OK")]),t(_.Z)],1)],1)],1)],1)]},proxy:!0},{key:"item.actions",fn:function({item:s}){return[t(r.Z,{staticClass:"mr-2",attrs:{small:"",text:""},on:{click:function(t){return e.editItem(s)}}},[t(f.Z,[e._v(" mdi-pencil ")])],1),t(r.Z,{attrs:{small:"",text:""},on:{click:function(t){return e.deleteItem(s)}}},[t(f.Z,[e._v(" mdi-delete ")])],1)]}},{key:"footer.prepend",fn:function(){return[t(He.Z,{attrs:{"max-width":"500px"},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:a}){return[t(r.Z,e._g(e._b({staticClass:"mb-2",attrs:{color:"primary",dark:""}},"v-btn",a,!1),s),[e._v(" Добавить "),t(f.Z,{staticClass:"ml-2"},[e._v("mdi-plus-box")])],1)]}}]),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[t(Oe.Z,[t(Se.EB,[t("span",{staticClass:"text-h5"},[e._v(e._s(e.formTitle))])]),t(Se.ZB,[t(l.Z,[t(Be.Z,[t(qe.Z,{attrs:{cols:"12"}},[t(Ne.Z,{attrs:{name:"ou[code]",label:"Code"},model:{value:e.editedItem.code,callback:function(t){e.$set(e.editedItem,"code",t)},expression:"editedItem.code"}})],1),t(qe.Z,{attrs:{cols:"12"}},[t(Ne.Z,{attrs:{name:"ou[description]",label:"Описание"},model:{value:e.editedItem.description,callback:function(t){e.$set(e.editedItem,"description",t)},expression:"editedItem.description"}})],1),t(qe.Z,{attrs:{cols:"12"}},[t(Ae.Z,{attrs:{name:"ou[is_tutors]",label:"Могут быть кураторами"},model:{value:e.editedItem.is_tutors,callback:function(t){e.$set(e.editedItem,"is_tutors",t)},expression:"editedItem.is_tutors"}})],1),t(qe.Z,{attrs:{cols:"12"}},[t(Le.Z,{attrs:{name:"ou[user_id]",type:"number",items:e.itemsTutor,label:"Ответственный"},on:{change:e.changeTutor},model:{value:e.editedItem.user_id,callback:function(t){e.$set(e.editedItem,"user_id",t)},expression:"editedItem.user_id"}})],1),t(qe.Z,{attrs:{cols:"12"}},[t(Ne.Z,{attrs:{name:"ou[sort]",label:"Sort"},model:{value:e.editedItem.sort,callback:function(t){e.$set(e.editedItem,"sort",t)},expression:"editedItem.sort"}})],1)],1)],1)],1),t(Se.h7,[t(_.Z),t(r.Z,{attrs:{color:"blue darken-1",text:""},on:{click:e.close}},[e._v(" Отмена ")]),t(r.Z,{attrs:{color:"blue darken-1",text:""},on:{click:e.save}},[e._v(" Сохранить ")])],1)],1)],1)]},proxy:!0}],null,!0)})},Ge=[],We={name:"MainOU",data:()=>({headers:[{text:"#",align:"start",value:"id"},{text:"Code",value:"code"},{text:"Ответственный",value:"tutor"},{text:"Описание",value:"description"},{text:"Sort",value:"sort"},{text:"Actions",value:"actions",sortable:!1}],desserts:[],itemsTutor:[],loading:!0,dialog:!1,dialogDelete:!1,editedIndex:-1,editedItem:{id:0,code:"",user_id:null,is_tutors:!1,tutor:"",description:"",sort:100},defaultItem:{id:0,code:"",user_id:null,is_tutors:!1,tutor:"",description:"",sort:100}}),methods:{changeTutor(e){this.itemsTutor.forEach(function(t){t.value==e&&(this.editedItem.tutor=t.text)}.bind(this))},load(){this.loading=!0;const e=new FormData;return e.append("f","list"),this.$http.post("/main/ou.php",e).then(function(e){this.desserts=e,this.loading=!1}.bind(this))},loadTutors(){const e=new FormData;return e.append("f","load-tutor"),this.$http.post("/main/ou.php",e).then(function(e){this.itemsTutor=e}.bind(this))},editItem(e){this.editedIndex=this.desserts.indexOf(e),this.editedItem=Object.assign({},e),this.dialog=!0},deleteItem(e){this.editedIndex=this.desserts.indexOf(e),this.editedItem=Object.assign({},e),this.dialogDelete=!0},deleteItemConfirm(){const e=new FormData;return e.append("f","remove"),e.append("id",this.editedItem.id),this.$http.post("/main/ou.php",e).then(function(e){if(e.id===this.editedItem.id){let e=this.editedItem.description,t=this.editedItem.code;this.$store.dispatch("snackbar/message",'Подразделение "'+e+" ("+t+')", успешно удаленно!'),this.desserts.splice(this.editedIndex,1),this.closeDelete()}}.bind(this))},close(){this.dialog=!1,this.$nextTick((()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1}))},closeDelete(){this.dialogDelete=!1,this.$nextTick((()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1}))},save(){const e=new FormData;return e.append("f","save"),e.append("ou[code]",this.editedItem.code),e.append("ou[user_id]",this.editedItem.user_id),e.append("ou[description]",this.editedItem.description),e.append("ou[sort]",this.editedItem.sort),e.append("ou[is_tutors]",this.editedItem.is_tutors?1:0),this.editedIndex>-1&&e.append("ou[id]",this.editedItem.id),this.$http.post("/main/ou.php",e).then(function(e){this.editedIndex>-1?(Object.assign(this.desserts[this.editedIndex],e),this.$store.dispatch("snackbar/message",'Подразделение "'+e.description+" ("+e.code+')", успешно изменено!')):(this.editedItem=e,this.desserts.push(this.editedItem),this.$store.dispatch("snackbar/message",'Подразделение "'+e.description+" ("+e.code+')", успешно изменено!')),this.close()}.bind(this))}},computed:{formTitle(){return-1===this.editedIndex?"New OU":"Edit OU - "+this.editedItem.code}},watch:{dialog(e){e||this.close()},dialogDelete(e){e||this.closeDelete()}},mounted(){this.loadTutors().finally(function(){this.load()}.bind(this))}},Re=We,Ye=(0,F.Z)(Re,Me,Ge,!1,null,"032ed5e6",null),Ve=Ye.exports,Ke=function(){var e=this,t=e._self._c;return t(Ue.Z,{staticClass:"elevation-1",attrs:{dense:"",headers:e.headers,items:e.desserts,"item-key":"code",loading:e.loading,"loading-text":"Loading... Please wait"},scopedSlots:e._u([{key:"top",fn:function(){return[t(b.Z,{attrs:{flat:""}},[t(g.qW,[e._v("Права")]),t(h.Z,{staticClass:"mx-4",attrs:{inset:"",vertical:""}}),t(_.Z),t(r.Z,{attrs:{dark:"",color:"light-blue"},on:{click:e.load}},[e._v(" Обновить "),t(f.Z,{staticClass:"ml-2"},[e._v("mdi-reload")])],1),t(He.Z,{attrs:{"max-width":"500px"},model:{value:e.dialogDelete,callback:function(t){e.dialogDelete=t},expression:"dialogDelete"}},[t(Oe.Z,[t(Se.EB,{staticClass:"text-h5"},[e._v("Are you sure you want to delete this item?")]),t(Se.h7,[t(_.Z),t(r.Z,{attrs:{color:"blue darken-1",text:""},on:{click:e.closeDelete}},[e._v("Отмена")]),t(r.Z,{attrs:{color:"blue darken-1",text:""},on:{click:e.deleteItemConfirm}},[e._v("OK")]),t(_.Z)],1)],1)],1)],1)]},proxy:!0},{key:"item.actions",fn:function({item:s}){return[t(r.Z,{staticClass:"mr-2",attrs:{small:"",text:""},on:{click:function(t){return e.editItem(s)}}},[t(f.Z,[e._v(" mdi-pencil ")])],1),t(r.Z,{attrs:{small:"",text:""},on:{click:function(t){return e.deleteItem(s)}}},[t(f.Z,[e._v(" mdi-delete ")])],1)]}},{key:"footer.prepend",fn:function(){return[t(He.Z,{attrs:{"max-width":"500px"},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:a}){return[t(r.Z,e._g(e._b({staticClass:"mb-2",attrs:{color:"primary",dark:""}},"v-btn",a,!1),s),[e._v(" Добавить "),t(f.Z,{staticClass:"ml-2"},[e._v("mdi-plus-box")])],1)]}}]),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[t(Oe.Z,[t(Se.EB,[t("span",{staticClass:"text-h5"},[e._v(e._s(e.formTitle))])]),t(Se.ZB,[t(l.Z,[t(Be.Z,[t(qe.Z,{attrs:{cols:"12"}},[t(Ne.Z,{attrs:{label:"Name"},model:{value:e.editedItem.name,callback:function(t){e.$set(e.editedItem,"name",t)},expression:"editedItem.name"}})],1),t(qe.Z,{attrs:{cols:"12"}},[t(Ne.Z,{attrs:{label:"Code"},model:{value:e.editedItem.code,callback:function(t){e.$set(e.editedItem,"code",t)},expression:"editedItem.code"}})],1)],1)],1)],1),t(Se.h7,[t(_.Z),t(r.Z,{attrs:{color:"blue darken-1",text:""},on:{click:e.close}},[e._v(" Отмена ")]),t(r.Z,{attrs:{color:"blue darken-1",text:""},on:{click:e.save}},[e._v(" Сохранить ")])],1)],1)],1)]},proxy:!0}],null,!0)})},Qe=[],ze={name:"MainClaimant",data:()=>({headers:[{text:"#",align:"start",value:"id"},{text:"Название",value:"name"},{text:"Code",value:"code"},{text:"Actions",value:"actions",sortable:!1}],desserts:[],loading:!0,dialog:!1,dialogDelete:!1,editedIndex:-1,editedItem:{id:0,code:"",name:""},defaultItem:{id:0,code:"",name:""}}),methods:{load(){this.loading=!0;const e=new FormData;return e.append("f","list"),this.$http.post("/main/claimant.php",e).then(function(e){this.desserts=e,this.loading=!1}.bind(this))},editItem(e){this.editedIndex=this.desserts.indexOf(e),this.editedItem=Object.assign({},e),this.dialog=!0},deleteItem(e){this.editedIndex=this.desserts.indexOf(e),this.editedItem=Object.assign({},e),this.dialogDelete=!0},deleteItemConfirm(){const e=new FormData;return e.append("f","remove"),e.append("id",this.editedItem.id),this.$http.post("/main/claimant.php",e).then(function(e){if(e.id===this.editedItem.id){let e=this.editedItem.name,t=this.editedItem.code;this.$store.dispatch("snackbar/message",'Право "'+e+" ("+t+')", успешно удалено!'),this.desserts.splice(this.editedIndex,1),this.closeDelete()}}.bind(this))},close(){this.dialog=!1,this.$nextTick((()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1}))},closeDelete(){this.dialogDelete=!1,this.$nextTick((()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1}))},save(){const e=new FormData;return e.append("f","save"),e.append("claimant[code]",this.editedItem.code),e.append("claimant[name]",this.editedItem.name),this.editedIndex>-1&&e.append("claimant[id]",this.editedItem.id),this.$http.post("/main/claimant.php",e).then(function(e){this.editedIndex>-1?(Object.assign(this.desserts[this.editedIndex],e),this.$store.dispatch("snackbar/message",'Право "'+e.name+" ("+e.code+')", успешно изменено!')):(this.editedItem=e,this.desserts.push(this.editedItem),this.$store.dispatch("snackbar/message",'Право "'+e.name+" ("+e.code+')", успешно созданно!')),this.close()}.bind(this))}},computed:{formTitle(){return-1===this.editedIndex?"New Claimant":"Edit Claimant - "+this.editedItem.name}},watch:{dialog(e){e||this.close()},dialogDelete(e){e||this.closeDelete()}},mounted(){this.load()}},Je=ze,Xe=(0,F.Z)(Je,Ke,Qe,!1,null,"7e3a21f2",null),et=Xe.exports,tt=s(30820),st=function(){var e=this,t=e._self._c;return t(Ue.Z,{staticClass:"elevation-1",attrs:{dense:"",headers:e.headers,items:e.desserts,"item-key":"code",loading:e.loading,"loading-text":"Loading... Please wait"},scopedSlots:e._u([{key:"top",fn:function(){return[t(b.Z,{attrs:{flat:""}},[t(g.qW,[e._v("Группы")]),t(h.Z,{staticClass:"mx-4",attrs:{inset:"",vertical:""}}),t(_.Z),t(tt.Z,{attrs:{small:"",mandatory:""},on:{change:e.load},model:{value:e.ou_id,callback:function(t){e.ou_id=t},expression:"ou_id"}},[t(r.Z,{attrs:{small:"",value:-1}},[e._v("Все")]),e._l(e.ous,(function(s,a){return t(r.Z,{key:a,attrs:{small:"",value:s.id}},[e._v(" "+e._s(s.description)+" ")])})),t(r.Z,{attrs:{small:"",value:null}},[e._v("Остальные")])],2),t(_.Z),t(r.Z,{attrs:{dark:"",color:"light-blue"},on:{click:e.load}},[e._v(" Reload "),t(f.Z,{staticClass:"ml-2"},[e._v("mdi-reload")])],1),t(He.Z,{attrs:{"max-width":"500px"},model:{value:e.dialogDelete,callback:function(t){e.dialogDelete=t},expression:"dialogDelete"}},[t(Oe.Z,[t(Se.EB,{staticClass:"text-h5"},[e._v("Are you sure you want to delete this item?")]),t(Se.h7,[t(_.Z),t(r.Z,{attrs:{color:"blue darken-1",text:""},on:{click:e.closeDelete}},[e._v("Отмена")]),t(r.Z,{attrs:{color:"blue darken-1",text:""},on:{click:e.deleteItemConfirm}},[e._v("OK")]),t(_.Z)],1)],1)],1)],1)]},proxy:!0},{key:"item.actions",fn:function({item:s}){return[t(r.Z,{staticClass:"mr-2",attrs:{small:"",text:"",to:{name:"main-group-edit",params:{code:s.code}}}},[t(f.Z,[e._v(" mdi-pencil ")])],1),t(r.Z,{attrs:{small:"",text:""},on:{click:function(t){return e.deleteItem(s)}}},[t(f.Z,[e._v(" mdi-delete ")])],1)]}},{key:"footer.prepend",fn:function(){return[t(r.Z,{staticClass:"mb-2",attrs:{color:"primary",dark:"",to:{name:"main-group-new",params:{ou_id:e.ou_id}}}},[e._v(" Добавить "),t(f.Z,{staticClass:"ml-2"},[e._v("mdi-plus-box")])],1)]},proxy:!0}],null,!0)})},at=[],nt={name:"MainGroups",data:()=>({headers:[{text:"#",align:"start",value:"id"},{text:"Название",value:"name"},{text:"Ответственный",value:"tutor"},{text:"Code",value:"code"},{text:"Sort",value:"sort"},{text:"Actions",value:"actions",sortable:!1}],desserts:[],ous:[],ou_id:-1,loading:!0,dialog:!1,dialogDelete:!1,editedIndex:-1,editedItem:{id:0,code:"",name:""},defaultItem:{id:0,code:"",name:""}}),methods:{loadOU(){const e=new FormData;return e.append("f","ous"),this.$http.post("/main/group.php",e).then(function(e){this.ous=e}.bind(this))},load(){this.loading=!0;const e=new FormData;return e.append("f","list"),e.append("ou_id",this.ou_id),this.$http.post("/main/group.php",e).then(function(e){this.desserts=e,this.loading=!1}.bind(this))},deleteItem(e){this.editedIndex=this.desserts.indexOf(e),this.editedItem=Object.assign({},e),this.dialogDelete=!0},deleteItemConfirm(){const e=new FormData;return e.append("f","remove"),e.append("id",this.editedItem.id),this.$http.post("/main/group.php",e).then(function(e){if(e.id===this.editedItem.id){let e=this.editedItem.name,t=this.editedItem.code;this.$store.dispatch("snackbar/message",'Группа "'+e+" ("+t+')", успешно удалена!'),this.desserts.splice(this.editedIndex,1),this.closeDelete()}}.bind(this))},close(){this.dialog=!1,this.$nextTick((()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1}))},closeDelete(){this.dialogDelete=!1,this.$nextTick((()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1}))}},watch:{dialog(e){e||this.close()},dialogDelete(e){e||this.closeDelete()}},mounted(){this.loadOU().finally(function(){this.load()}.bind(this))}},it=nt,ot=(0,F.Z)(it,st,at,!1,null,"477f560c",null),rt=ot.exports,lt=s(65005),dt=s(7552),ct=s(10626),ut=s(45517),mt=s(62741),pt=s(64415),ht=function(){var e=this,t=e._self._c;return t(lt.Z,{ref:"form"},[t(Oe.Z,{staticClass:"mx-auto"},[t(Se.EB,{staticClass:"text-h5"},[e._v(" "+e._s(e.title)+" "),t(_.Z),e._v(e._s(e.xTimestamp)+" ")],1),t(Se.ZB,[t(mt.Z,{attrs:{"background-color":"primary",dark:""}},[t(ct.Z,[e._v(" Общее ")]),t(ct.Z,[e._v(" Пользователи ")]),t(ct.Z,[e._v(" Права ")]),t(ut.Z,[t(Oe.Z,{attrs:{flat:""}},[t(Se.ZB,[t(Ne.Z,{attrs:{name:"group[name]",outlined:"",label:"Название",placeholder:"Название",rules:e.rules.name},model:{value:e.data.name,callback:function(t){e.$set(e.data,"name",t)},expression:"data.name"}}),t(Ne.Z,{attrs:{name:"group[code]",outlined:"",label:"Code",placeholder:"Code",rules:e.rules.code,required:""},model:{value:e.data.code,callback:function(t){e.$set(e.data,"code",t)},expression:"data.code"}}),t(Ne.Z,{attrs:{name:"group[sort]",outlined:"",label:"Sort",placeholder:"Sort",type:"number",rules:e.rules.sort},model:{value:e.data.sort,callback:function(t){e.$set(e.data,"sort",t)},expression:"data.sort"}}),t(Le.Z,{attrs:{name:"group[user_id]",outlined:"",items:e.tutors,label:"Ответственный"},model:{value:e.data.user_id,callback:function(t){e.$set(e.data,"user_id",t)},expression:"data.user_id"}}),t(Le.Z,{attrs:{name:"group[ou_id]",outlined:"",items:e.ous,label:"Подразделение"},on:{change:e.loadGroups},model:{value:e.data.ou_id,callback:function(t){e.$set(e.data,"ou_id",t)},expression:"data.ou_id"}}),t(Le.Z,{attrs:{name:"group[parent_id]",outlined:"",items:e.groups,label:"Родительская группа"},model:{value:e.data.parent_id,callback:function(t){e.$set(e.data,"parent_id",t)},expression:"data.parent_id"}}),t(pt.Z,{attrs:{name:"group[description]",outlined:"",label:"Описание",placeholder:"Описание",rules:e.rules.description},model:{value:e.data.description,callback:function(t){e.$set(e.data,"description",t)},expression:"data.description"}}),t(Ae.Z,{attrs:{name:"group[active]",label:"Активная"},model:{value:e.data.active,callback:function(t){e.$set(e.data,"active",t)},expression:"data.active"}}),t(Ae.Z,{attrs:{name:"group[anonymous]",label:"Анонимная"},model:{value:e.data.anonymous,callback:function(t){e.$set(e.data,"anonymous",t)},expression:"data.anonymous"}}),t("v-datetime-picker",{attrs:{"text-field-props":e.textFieldProps("group[activeFrom]"),"time-picker-props":e.timePickerProps,timeFormat:"HH:mm:ss",label:"Активный с",placeholder:"Активный c"},model:{value:e.data.activeFrom,callback:function(t){e.$set(e.data,"activeFrom",t)},expression:"data.activeFrom"}}),t("v-datetime-picker",{attrs:{"text-field-props":e.textFieldProps("group[activeTo]"),"time-picker-props":e.timePickerProps,timeFormat:"HH:mm:ss",label:"Активный по",placeholder:"Активный по"},model:{value:e.data.activeTo,callback:function(t){e.$set(e.data,"activeTo",t)},expression:"data.activeTo"}})],1)],1)],1),t(ut.Z,[t(Oe.Z,{attrs:{flat:""}},[t(Se.ZB,[t(Le.Z,{ref:"users",attrs:{items:e.users,label:"Добавить"},on:{change:e.addUser}}),t(dt.Z,{scopedSlots:e._u([{key:"default",fn:function(){return[t("tbody",e._l(e.data.users,(function(s,a){return t("tr",{key:a},[t("td",[e._v(" "+e._s(s.name)+" "),t("input",{attrs:{type:"hidden",name:"group[users]["+a+"][group_id]"},domProps:{value:s.group_id}}),t("input",{attrs:{type:"hidden",name:"group[users]["+a+"][user_id]"},domProps:{value:s.user_id}})]),t("td",[t("v-datetime-picker",{attrs:{"text-field-props":e.textFieldProps("group[users]["+a+"][activeFrom]"),"time-picker-props":e.timePickerProps,timeFormat:"HH:mm:ss",label:"Активный с",placeholder:"Активный c"},model:{value:s.activeFrom,callback:function(t){e.$set(s,"activeFrom",t)},expression:"item.activeFrom"}})],1),t("td",[t("v-datetime-picker",{attrs:{"text-field-props":e.textFieldProps("group[users]["+a+"][activeTo]"),"time-picker-props":e.timePickerProps,timeFormat:"HH:mm:ss",label:"Активный по",placeholder:"Активный по"},model:{value:s.activeTo,callback:function(t){e.$set(s,"activeTo",t)},expression:"item.activeTo"}})],1),t("td",[t(r.Z,{attrs:{small:"",color:"warning",title:"Удалить"},on:{click:function(t){return e.removeUser(a)}}},[t(f.Z,[e._v(" mdi-delete ")])],1)],1)])})),0)]},proxy:!0}])})],1)],1)],1),t(ut.Z,[t(Oe.Z,{attrs:{flat:""}},[t(Se.ZB,[t(Le.Z,{ref:"claimants",attrs:{items:e.claimants,label:"Добавить"},on:{change:e.addAccess}}),t(dt.Z,{scopedSlots:e._u([{key:"default",fn:function(){return[t("tbody",e._l(e.data.accesses,(function(s,a){return t("tr",{key:a},[t("td",[e._v(" "+e._s(s.name)+" "),t("input",{attrs:{type:"hidden",name:"group[accesses]["+a+"][group_id]"},domProps:{value:s.group_id}}),t("input",{attrs:{type:"hidden",name:"group[accesses]["+a+"][claimant_id]"},domProps:{value:s.claimant_id}})]),t("td",[t(Ne.Z,{attrs:{name:"group[accesses]["+a+"][access]",type:"number",label:"Level"},model:{value:s.access,callback:function(t){e.$set(s,"access",t)},expression:"item.access"}})],1)])})),0)]},proxy:!0}])})],1)],1)],1)],1)],1),t(Se.h7,[t(r.Z,{staticClass:"mr-4",attrs:{color:"green"},on:{click:function(t){return e.save(!0)}}},[e._v(" Сохранить ")]),t(r.Z,{staticClass:"mr-4",attrs:{color:"primary"},on:{click:function(t){return e.save(!1)}}},[e._v(" Применить ")]),t(r.Z,{on:{click:function(t){return e.$router.back()}}},[e._v(" Назад ")])],1)],1)],1)},ft=[];let vt=0;var _t={name:"MainGroup",data:()=>({tutors:[],ous:[],groups:[],claimants:[],users:[],rules:{code:[e=>!!e||"Code is required",e=>e&&e.length<=255||"Code must be less than 255 characters"],name:[e=>!!e||"Name is required"],sort:[],description:[]},oldName:null,data:{id:null,name:"",code:"",sort:100,description:null,user_id:null,active:!0,anonymous:!1,ou_id:null,parent_id:null,x_timestamp:null,activeFrom:null,activeTo:null,accesses:{},users:{}},timePickerProps:{ampmInTitle:!0,format:"24hr"}}),computed:{title(){return this.data.id?'Группа "'+this.oldName+'"':"Новая группа"},xTimestamp(){if(this.data.id){const e=new Date(this.data.x_timestamp);return e.toLocaleString()}return""}},methods:{textFieldProps(e){return e=e||"",{name:e,type:"datetime"}},save(e){const t=!this.data.id,s=new FormData(this.$refs.form.$el);return s.append("f","save"),s.append("group[active]",this.data.active?1:0),s.append("group[anonymous]",this.data.anonymous?1:0),t||s.append("group[id]",this.data.id),this.$http.post("/main/group.php",s).then(function(s){t?this.$store.dispatch("snackbar/message",'Група "'+s.name+" ("+s.code+')", успешно создана!'):this.$store.dispatch("snackbar/message",'Група "'+s.name+" ("+s.code+')", успешно изменена!'),this.oldName=this.data.name,e?this.$router.go(-1):(this.data=s,this.data.accesses||this.$set(this.data,"accesses",{}),this.data.users||this.$set(this.data,"users",{}))}.bind(this))},load(){const e=new FormData;return e.append("f","load"),e.append("group[code]",this.$route.params.code),this.$http.post("/main/group.php",e).then(function(e){this.data=e,this.data.accesses||this.$set(this.data,"accesses",{}),this.data.users||this.$set(this.data,"users",{}),this.oldName=this.data.name}.bind(this))},loadTutors(){const e=new FormData;return e.append("f","load-tutors"),this.$http.post("/main/group.php",e).then(function(e){this.tutors=e}.bind(this))},loadUsers(){const e=new FormData;return e.append("f","load-users"),this.$http.post("/main/group.php",e).then(function(e){this.users=e}.bind(this))},loadOUs(){const e=new FormData;return e.append("f","load-ous"),this.$http.post("/main/group.php",e).then(function(e){this.ous=e,this.loadGroups()}.bind(this))},loadGroups(){const e=new FormData;return e.append("f","load-groups"),e.append("ou_id",this.data.ou_id),e.append("group_id",this.data.id),this.$http.post("/main/group.php",e).then(function(e){this.groups=e}.bind(this))},loadClaimants(){const e=new FormData;return e.append("f","load-claimants"),this.$http.post("/main/group.php",e).then(function(e){this.claimants=e}.bind(this))},addAccess(e){let t=!1,s={id:"n"+vt++,group_id:this.data.id,claimant_id:e,name:"",access:0};this.claimants.forEach((function(t){t.value==e&&(s.name=t.text)})),Object.keys(this.data.accesses).forEach(function(s){t=t||this.data.accesses[s].claimant_id==e}.bind(this)),t?this.$store.dispatch("snackbar/message",'Нельзя добавить "'+s.name+'"! Уже есть!'):this.$set(this.data.accesses,s.id,s),this.$refs.claimants.reset()},addUser(e){let t=!1,s={id:"n"+vt++,group_id:this.data.id,user_id:e,name:"",activeFrom:null,activeTo:null};this.users.forEach((function(t){t.value==e&&(s.name=t.text)})),Object.keys(this.data.users).forEach(function(s){t=t||this.data.users[s].user_id==e}.bind(this)),t?this.$store.dispatch("snackbar/message",'Нельзя добавить "'+s.name+'"! Уже есть!'):this.$set(this.data.users,s.id,s),this.$refs.users.reset()},removeUser(e){this.$delete(this.data.users,e)}},mounted(){this.$route.params.ou_id>0&&(this.data.ou_id=this.$route.params.ou_id),this.load().finally(function(){return this.loadTutors()}.bind(this)).finally(function(){return this.loadOUs()}.bind(this)).finally(function(){return this.loadClaimants()}.bind(this)).finally(function(){return this.loadUsers()}.bind(this))}},bt=_t,gt=(0,F.Z)(bt,ht,ft,!1,null,"55de9bb9",null),Zt=gt.exports,kt=s(20488),xt=function(){var e=this,t=e._self._c;return t(Ue.Z,{staticClass:"elevation-1",attrs:{dense:"",headers:e.headers,items:e.desserts,"item-key":"code",loading:e.loading,"loading-text":"Loading... Please wait"},scopedSlots:e._u([{key:"top",fn:function(){return[t(b.Z,{attrs:{flat:""}},[t(g.qW,[e._v("Пользователи")]),t(h.Z,{staticClass:"mx-4",attrs:{inset:"",vertical:""}}),t(_.Z),t(tt.Z,{attrs:{small:"",mandatory:""},on:{change:e.changeOu},model:{value:e.ou_id,callback:function(t){e.ou_id=t},expression:"ou_id"}},[t(r.Z,{attrs:{small:"",value:-1}},[e._v("Все")]),e._l(e.ous,(function(s,a){return[s.items?t(O.Z,{key:a,attrs:{"offset-y":"","open-on-hover":""},scopedSlots:e._u([{key:"activator",fn:function({on:a,attrs:n}){return[t(r.Z,e._g(e._b({attrs:{small:"",value:s.id}},"v-btn",n,!1),a),[e._v(" "+e._s(s.description)+" "),s.items?t(f.Z,[e._v("mdi-chevron-down")]):e._e()],1)]}}],null,!0)},[t(x.Z,[t(kt.Z,{on:{change:e.changeGroup},model:{value:e.group_id,callback:function(t){e.group_id=t},expression:"group_id"}},e._l(s.items,(function(s,a){return t($.Z,{key:a,attrs:{value:s.id}},[t(w.km,[t(w.V9,[e._v(e._s(s.name))])],1)],1)})),1)],1)],1):e._e()]})),t(r.Z,{attrs:{small:"",value:null}},[e._v("Остальные")])],2),t(_.Z),t(r.Z,{attrs:{dark:"",color:"light-blue"},on:{click:e.load}},[e._v(" Reload "),t(f.Z,{staticClass:"ml-2"},[e._v("mdi-reload")])],1),t(He.Z,{attrs:{"max-width":"500px"},model:{value:e.dialogDelete,callback:function(t){e.dialogDelete=t},expression:"dialogDelete"}},[t(Oe.Z,[t(Se.EB,{staticClass:"text-h5"},[e._v("Are you sure you want to delete this item?")]),t(Se.h7,[t(_.Z),t(r.Z,{attrs:{color:"blue darken-1",text:""},on:{click:e.closeDelete}},[e._v("Cancel")]),t(r.Z,{attrs:{color:"blue darken-1",text:""},on:{click:e.deleteItemConfirm}},[e._v("OK")]),t(_.Z)],1)],1)],1)],1)]},proxy:!0},{key:"item.actions",fn:function({item:s}){return[t(r.Z,{staticClass:"mr-2",attrs:{small:"",text:"",to:{name:"main-user-edit",params:{login:s.login}}}},[t(f.Z,[e._v(" mdi-pencil ")])],1),t(r.Z,{attrs:{small:"",text:""},on:{click:function(t){return e.deleteItem(s)}}},[t(f.Z,[e._v(" mdi-delete ")])],1)]}},{key:"footer.prepend",fn:function(){return[t(r.Z,{staticClass:"mb-2",attrs:{color:"primary",dark:"",to:{name:"main-user-new",params:{ou_id:e.ou_id}}}},[e._v(" Добавить "),t(f.Z,{staticClass:"ml-2"},[e._v("mdi-plus-box")])],1)]},proxy:!0}],null,!0)})},yt=[],$t={name:"MainUsers",data:()=>({headers:[{text:"#",align:"start",value:"id"},{text:"Login",value:"login"},{text:"Alias",value:"alias"},{text:"Куратор",value:"tutor"},{text:"Actions",value:"actions",sortable:!1}],ou_id:-1,group_id:-1,desserts:[],loading:!0,editedIndex:-1,editedItem:{},dialog:!1,dialogDelete:!1,ous:[]}),methods:{changeOu(){this.group_id=-1,this.load()},changeGroup(){this.load()},load(){this.loading=!0;const e=new FormData;return e.append("f","list"),e.append("ou_id",this.ou_id),e.append("group_id",this.group_id),this.$http.post("/main/user.php",e).then(function(e){this.desserts=e,this.loading=!1}.bind(this))},loadFilter(){let e=new FormData;return e.append("f","load-filters"),this.$http.post("/main/user.php",e).then(function(e){this.ous=e}.bind(this))},deleteItem(e){this.editedIndex=this.desserts.indexOf(e),this.editedItem=Object.assign({},e),this.dialogDelete=!0},deleteItemConfirm(){const e=new FormData;return e.append("f","remove"),e.append("id",this.editedItem.id),this.$http.post("/main/user.php",e).then(function(e){e.id===this.editedItem.id&&(this.desserts.splice(this.editedIndex,1),this.closeDelete())}.bind(this))},closeDelete(){this.dialogDelete=!1,this.$nextTick((()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1}))}},watch:{dialogDelete(e){e||this.closeDelete()}},mounted(){this.loadFilter().finally(function(){this.load()}.bind(this))}},wt=$t,Et=(0,F.Z)(wt,xt,yt,!1,null,"1bbc9180",null),It=Et.exports,Ct=function(){var e=this,t=e._self._c;return t(lt.Z,{ref:"form"},[t(Oe.Z,{staticClass:"mx-auto"},[t(Se.EB,{staticClass:"text-h5"},[e._v(" "+e._s(e.title)+" "),t(_.Z),e._v(e._s(e.xTimestamp)+" ")],1),t(Se.ZB,[t(mt.Z,{attrs:{"background-color":"primary",dark:""}},[t(ct.Z,[e._v(" Общее ")]),t(ct.Z,[e._v(" Группы ")]),t(ct.Z,[e._v(" Права ")]),t(ut.Z,[t(Oe.Z,{attrs:{flat:""}},[t(Se.ZB,[t(Ne.Z,{attrs:{name:"user[login]",outlined:"",label:"Логин",placeholder:"Логин",rules:e.rules.login,required:""},model:{value:e.data.login,callback:function(t){e.$set(e.data,"login",t)},expression:"data.login"}}),t(Le.Z,{attrs:{name:"user[ou_id]",outlined:"",items:e.ous,label:"Подразделение"},model:{value:e.data.ou_id,callback:function(t){e.$set(e.data,"ou_id",t)},expression:"data.ou_id"}}),t(Le.Z,{attrs:{name:"user[parent_id]",outlined:"",items:e.tutors,label:"Куратор"},model:{value:e.data.parent_id,callback:function(t){e.$set(e.data,"parent_id",t)},expression:"data.parent_id"}}),t(Ne.Z,{attrs:{name:"user[alias]",outlined:"",label:"Псевдоним",placeholder:"Псевдоним",rules:e.rules.alias},model:{value:e.data.alias,callback:function(t){e.$set(e.data,"alias",t)},expression:"data.alias"}}),t(Ae.Z,{attrs:{name:"user[active]",label:"Активная"},model:{value:e.data.active,callback:function(t){e.$set(e.data,"active",t)},expression:"data.active"}}),t(Ae.Z,{attrs:{name:"user[loocked]",label:"Заблокирован"},model:{value:e.data.loocked,callback:function(t){e.$set(e.data,"loocked",t)},expression:"data.loocked"}}),t("v-datetime-picker",{attrs:{"text-field-props":e.textFieldProps("user[activeFrom]"),"time-picker-props":e.timePickerProps,timeFormat:"HH:mm:ss",label:"Активный с",placeholder:"Активный c"},model:{value:e.data.activeFrom,callback:function(t){e.$set(e.data,"activeFrom",t)},expression:"data.activeFrom"}}),t("v-datetime-picker",{attrs:{"text-field-props":e.textFieldProps("user[activeTo]"),"time-picker-props":e.timePickerProps,timeFormat:"HH:mm:ss",label:"Активный по",placeholder:"Активный по"},model:{value:e.data.activeTo,callback:function(t){e.$set(e.data,"activeTo",t)},expression:"data.activeTo"}}),t(Ne.Z,{attrs:{name:"user[email]",outlined:"",label:"Email",placeholder:"Email",type:"email",rules:e.rules.email},model:{value:e.data.email,callback:function(t){e.$set(e.data,"email",t)},expression:"data.email"}}),t(Ne.Z,{attrs:{name:"user[phone]",outlined:"",label:"Псевдоним",placeholder:"Телефон",rules:e.rules.phone},model:{value:e.data.phone,callback:function(t){e.$set(e.data,"phone",t)},expression:"data.phone"}}),t(Ne.Z,{attrs:{name:"user[first_name]",outlined:"",label:"Имя",placeholder:"Имя",rules:e.rules.patronymic},model:{value:e.data.first_name,callback:function(t){e.$set(e.data,"first_name",t)},expression:"data.first_name"}}),t(Ne.Z,{attrs:{name:"user[second_name]",outlined:"",label:"Фамилия",placeholder:"Фамилия",rules:e.rules.patronymic},model:{value:e.data.second_name,callback:function(t){e.$set(e.data,"second_name",t)},expression:"data.second_name"}}),t(Ne.Z,{attrs:{name:"user[patronymic]",outlined:"",label:"Отчество",placeholder:"Отчество",rules:e.rules.patronymic},model:{value:e.data.patronymic,callback:function(t){e.$set(e.data,"patronymic",t)},expression:"data.patronymic"}}),t(Ne.Z,{attrs:{name:"user[gender]",outlined:"",label:"Пол",placeholder:"Пол"},model:{value:e.data.gender,callback:function(t){e.$set(e.data,"gender",t)},expression:"data.gender"}}),t(Ne.Z,{attrs:{name:"user[country]",outlined:"",label:"Страна",placeholder:"Страна"},model:{value:e.data.country,callback:function(t){e.$set(e.data,"country",t)},expression:"data.country"}}),t(pt.Z,{attrs:{name:"user[description]",outlined:"",label:"Описание",placeholder:"Описание",rules:e.rules.description},model:{value:e.data.description,callback:function(t){e.$set(e.data,"description",t)},expression:"data.description"}})],1)],1)],1),t(ut.Z,[t(Oe.Z,{attrs:{flat:""}},[t(Se.ZB,[t(Le.Z,{ref:"groups",attrs:{items:e.groups,label:"Добавить"},on:{change:e.addGroup}}),t(dt.Z,{scopedSlots:e._u([{key:"default",fn:function(){return[t("tbody",e._l(e.data.groups,(function(s,a){return t("tr",{key:a},[t("td",[e._v(" "+e._s(s.name)+" "),t("input",{attrs:{type:"hidden",name:"user[groups]["+a+"][group_id]"},domProps:{value:s.group_id}}),t("input",{attrs:{type:"hidden",name:"user[groups]["+a+"][user_id]"},domProps:{value:s.user_id}})]),t("td",[t("v-datetime-picker",{attrs:{"text-field-props":e.textFieldProps("user[groups]["+a+"][activeFrom]"),"time-picker-props":e.timePickerProps,timeFormat:"HH:mm:ss",label:"Активный с",placeholder:"Активный c"},model:{value:s.activeFrom,callback:function(t){e.$set(s,"activeFrom",t)},expression:"item.activeFrom"}})],1),t("td",[t("v-datetime-picker",{attrs:{"text-field-props":e.textFieldProps("user[groups]["+a+"][activeTo]"),"time-picker-props":e.timePickerProps,timeFormat:"HH:mm:ss",label:"Активный по",placeholder:"Активный по"},model:{value:s.activeTo,callback:function(t){e.$set(s,"activeTo",t)},expression:"item.activeTo"}})],1),t("td",[t(r.Z,{attrs:{small:"",color:"warning",title:"Удалить"},on:{click:function(t){return e.delGroup(a)}}},[t(f.Z,[e._v(" mdi-delete ")])],1)],1)])})),0)]},proxy:!0}])})],1)],1)],1),t(ut.Z,[t(Oe.Z,{attrs:{flat:""}},[t(Se.ZB,[t(Le.Z,{ref:"claimants",attrs:{items:e.claimants,label:"Добавить"},on:{change:e.addAccess}}),t(dt.Z,{scopedSlots:e._u([{key:"default",fn:function(){return[t("tbody",e._l(e.data.accesses,(function(s,a){return t("tr",{key:a},[t("td",[e._v(" "+e._s(s.name)+" "),t("input",{attrs:{type:"hidden",name:"user[accesses]["+a+"][user_id]"},domProps:{value:s.user_id}}),t("input",{attrs:{type:"hidden",name:"user[accesses]["+a+"][claimant_id]"},domProps:{value:s.claimant_id}})]),t("td",[t(Ne.Z,{attrs:{name:"user[accesses]["+a+"][access]",type:"number",label:"Level"},model:{value:s.access,callback:function(t){e.$set(s,"access",t)},expression:"item.access"}})],1)])})),0)]},proxy:!0}])})],1)],1)],1)],1)],1),t(Se.h7,[t(r.Z,{staticClass:"mr-4",attrs:{color:"green"},on:{click:function(t){return e.save(!0)}}},[e._v(" Сохранить ")]),t(r.Z,{staticClass:"mr-4",attrs:{color:"primary"},on:{click:function(t){return e.save(!1)}}},[e._v(" Применить ")]),t(r.Z,{on:{click:function(t){return e.$router.back()}}},[e._v(" Назад ")])],1)],1)],1)},Dt=[];let Tt=0;var Ft={name:"MainUser",data:()=>({snackbar:!1,snackbar_text:"",rules:{login:[e=>!!e||"Login is required",e=>e&&e.length<=255||"Логин должен быть меньше 255 символов"],alias:[e=>!!e||"Alias is required",e=>e&&e.length>=6||"Псевдоним должен быть больше 6 симоволов"],email:[],first_name:[],second_name:[],patronymic:[],description:[]},oldName:null,ous:[],tutors:[],groups:[],claimants:[],data:{id:null,parent_id:null,x_timestamp:"",date_register:"",last_login:"",last_ip:"",active:!0,activeFrom:null,activeTo:null,loocked:!1,stored_hash:"",checkword:"",login:"",email:"",password:"",alias:"",first_name:"",second_name:"",patronymic:"",gender:"",login_attempts:0,country:"RU",ou_id:null,phone:null,description:null},timePickerProps:{ampmInTitle:!0,format:"24hr"}}),computed:{title(){return this.data.id?'Пользователь "'+this.oldName+'"':"Новый пользователь"},xTimestamp(){if(this.data.id){const e=new Date(this.data.x_timestamp);return e.toLocaleString()}return""}},methods:{textFieldProps(e){return e=e||"",{name:e,type:"datetime"}},save(e){const t=!this.data.id,s=new FormData(this.$refs.form.$el);return s.append("f","save"),s.append("user[active]",this.data.active?1:0),s.append("user[loocked]",this.data.anonymous?1:0),t||s.append("user[id]",this.data.id),this.$http.post("/main/user.php",s).then(function(s){t?this.$store.dispatch("snackbar/message",'Пользователь "'+s.login+" ("+s.alias+')", успешно создан!'):this.$store.dispatch("snackbar/message",'Пользователь "'+s.login+" ("+s.alias+')", успешно изменен!'),this.oldName=this.data.login,e?this.$router.go(-1):(this.data=s,this.data.accesses||this.$set(this.data,"accesses",{}),this.data.groups||this.$set(this.data,"groups",{}))}.bind(this))},load(){const e=new FormData;return e.append("f","load"),e.append("user[login]",this.$route.params.login),this.$http.post("/main/user.php",e).then(function(e){this.data=e,this.data.accesses||this.$set(this.data,"accesses",{}),this.data.groups||this.$set(this.data,"groups",{}),this.oldName=this.data.login}.bind(this))},loadOUs(){const e=new FormData;return e.append("f","load-ous"),this.$http.post("/main/user.php",e).then(function(e){this.ous=e}.bind(this))},loadTutors(){const e=new FormData;return e.append("f","load-tutors"),e.append("id",this.data.id),this.$http.post("/main/user.php",e).then(function(e){this.tutors=e}.bind(this))},loadClaimants(){const e=new FormData;return e.append("f","load-claimants"),this.$http.post("/main/user.php",e).then(function(e){this.claimants=e}.bind(this))},loadGroups(){const e=new FormData;return e.append("f","load-groups"),this.$http.post("/main/user.php",e).then(function(e){this.groups=e}.bind(this))},addAccess(e){let t=!1,s={id:"n"+Tt++,user_id:this.data.id,claimant_id:e,name:"",access:0};this.claimants.forEach((function(t){t.value==e&&(s.name=t.text)})),Object.keys(this.data.accesses).forEach(function(s){t=t||this.data.accesses[s].claimant_id==e}.bind(this)),t?this.$store.dispatch("snackbar/message",'Нельзя добавить "'+s.name+'"! Уже есть!'):this.$set(this.data.accesses,s.id,s),this.$refs.claimants.reset()},addGroup(e){let t=!1,s={id:"n"+Tt++,group_id:e,user_id:this.data.id,name:"",activeFrom:null,activeTo:null};this.groups.forEach((function(t){t.value==e&&(s.name=t.text)})),Object.keys(this.data.groups).forEach(function(s){t=t||this.data.groups[s].group_id==e}.bind(this)),t?this.$store.dispatch("snackbar/message",'Нельзя добавить "'+s.name+'"! Уже есть!'):this.$set(this.data.groups,s.id,s),this.$refs.groups.reset()},delGroup(e){this.$delete(this.data.groups,e)}},mounted(){this.$route.params.ou_id>0&&(this.data.ou_id=this.$route.params.ou_id),this.load().finally(function(){return this.loadOUs()}.bind(this)).finally(function(){return this.loadTutors()}.bind(this)).finally(function(){return this.loadGroups()}.bind(this)).finally(function(){return this.loadClaimants()}.bind(this))}},Pt=Ft,jt=(0,F.Z)(Pt,Ct,Dt,!1,null,"4edbdd81",null),Ot=jt.exports,St=function(){var e=this,t=e._self._c;return t(Ue.Z,{staticClass:"elevation-1",attrs:{dense:"",headers:e.headers,items:e.desserts,"item-key":"id",loading:e.loading,"loading-text":"Loading... Please wait"},scopedSlots:e._u([{key:"top",fn:function(){return[t(b.Z,{attrs:{flat:""}},[t(g.qW,[e._v("Предмет")]),t(h.Z,{staticClass:"mx-4",attrs:{inset:"",vertical:""}}),t(_.Z),t(r.Z,{attrs:{dark:"",color:"light-blue"},on:{click:e.load}},[e._v(" Обновить "),t(f.Z,{staticClass:"ml-2"},[e._v("mdi-reload")])],1),t(He.Z,{attrs:{"max-width":"500px"},model:{value:e.dialogDelete,callback:function(t){e.dialogDelete=t},expression:"dialogDelete"}},[t(Oe.Z,[t(Se.EB,{staticClass:"text-h5"},[e._v("Are you sure you want to delete this item?")]),t(Se.h7,[t(_.Z),t(r.Z,{attrs:{color:"blue darken-1",text:""},on:{click:e.closeDelete}},[e._v("Отмена")]),t(r.Z,{attrs:{color:"blue darken-1",text:""},on:{click:e.deleteItemConfirm}},[e._v("OK")]),t(_.Z)],1)],1)],1)],1)]},proxy:!0},{key:"item.actions",fn:function({item:s}){return[t(r.Z,{staticClass:"mr-2",attrs:{small:"",text:"",to:{name:"ep-subject-edit",params:{id:s.id}}}},[t(f.Z,[e._v(" mdi-pencil ")])],1),t(r.Z,{attrs:{small:"",text:""},on:{click:function(t){return e.deleteItem(s)}}},[t(f.Z,[e._v(" mdi-delete ")])],1)]}},{key:"footer.prepend",fn:function(){return[t(r.Z,{staticClass:"mb-2",attrs:{color:"primary",dark:"",to:{name:"ep-subject-new"}}},[e._v(" Добавить "),t(f.Z,{staticClass:"ml-2"},[e._v("mdi-plus-box")])],1)]},proxy:!0}],null,!0)})},At=[],qt={name:"EpSubjects",data:()=>({headers:[{text:"#",align:"start",value:"id"},{text:"Название",value:"name"},{text:"Sort",value:"sort"},{text:"Actions",value:"actions",sortable:!1}],desserts:[],loading:!0,dialogDelete:!1,editedIndex:-1,editedItem:{id:0,name:"",sort:100},defaultItem:{id:0,name:"",sort:100}}),methods:{load(){this.loading=!0;const e=new FormData;return e.append("f","list"),this.$http.post("/ep/subject.php",e).then(function(e){this.desserts=e,this.loading=!1}.bind(this))},deleteItem(e){this.editedIndex=this.desserts.indexOf(e),this.editedItem=Object.assign({},e),this.dialogDelete=!0},deleteItemConfirm(){const e=new FormData;return e.append("f","remove"),e.append("id",this.editedItem.id),this.$http.post("/ep/subject.php",e).then(function(e){if(e.id===this.editedItem.id){let e=this.editedItem.name;this.$store.dispatch("snackbar/message",'Предмет "'+e+'", успешно удален!'),this.desserts.splice(this.editedIndex,1),this.closeDelete()}}.bind(this))},closeDelete(){this.dialogDelete=!1,this.$nextTick((()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1}))}},watch:{dialogDelete(e){e||this.closeDelete()}},mounted(){this.load()}},Ut=qt,Ht=(0,F.Z)(Ut,St,At,!1,null,"119c1deb",null),Bt=Ht.exports,Lt=function(){var e=this,t=e._self._c;return t(lt.Z,{ref:"form"},[t(Oe.Z,{staticClass:"mx-auto"},[t(Se.EB,{staticClass:"text-h5"},[e._v(" "+e._s(e.title)+" ")]),t(Se.ZB,[t(Be.Z,[t(qe.Z,{attrs:{cols:"12",md:"6"}},[t(Ne.Z,{attrs:{name:"subject[name]",outlined:"",label:"Название",placeholder:"Название",rules:e.rules.name},model:{value:e.data.name,callback:function(t){e.$set(e.data,"name",t)},expression:"data.name"}}),t(Ne.Z,{attrs:{name:"subject[sort]",outlined:"",label:"Sort",placeholder:"Sort",rules:e.rules.sort,type:"number"},model:{value:e.data.sort,callback:function(t){e.$set(e.data,"sort",t)},expression:"data.sort"}})],1),t(qe.Z,{attrs:{cols:"12",md:"6"}},[t(Le.Z,{ref:"teachers",attrs:{items:e.teachers,label:"Учителя"},on:{change:e.addTeacher}}),t(dt.Z,{scopedSlots:e._u([{key:"default",fn:function(){return[t("tbody",e._l(e.data.users,(function(s,a){return t("tr",{key:a},[t("td",[e._v(" "+e._s(s.name)+" "),t("input",{attrs:{type:"hidden",name:"subject[users]["+a+"][user_id]"},domProps:{value:s.user_id}})]),t("td",[t(r.Z,{attrs:{small:"",color:"warning",title:"Удалить"},on:{click:function(t){return e.removeTeacher(a)}}},[t(f.Z,[e._v(" mdi-delete ")])],1)],1)])})),0)]},proxy:!0}])})],1)],1)],1),t(Se.h7,[t(r.Z,{staticClass:"mr-4",attrs:{color:"green"},on:{click:function(t){return e.save(!0)}}},[e._v(" Сохранить ")]),t(r.Z,{staticClass:"mr-4",attrs:{color:"primary"},on:{click:function(t){return e.save(!1)}}},[e._v(" Применить ")]),t(r.Z,{on:{click:function(t){return e.$router.back()}}},[e._v(" Назад ")])],1)],1)],1)},Nt=[];let Mt=0;var Gt={name:"EpSubject",computed:{title(){return this.data.id?'Предмет "'+this.oldName+'"':"Новый предмет"}},data:()=>({oldName:"",rules:{name:[e=>!!e||"Name is required"],sort:[]},teachers:[],data:{id:null,name:"",sort:100}}),methods:{save(e){const t=!this.data.id,s=new FormData(this.$refs.form.$el);return s.append("f","save"),t||s.append("subject[id]",this.data.id),this.$http.post("/ep/subject.php",s).then(function(s){t?this.$store.dispatch("snackbar/message",'Предмет "'+s.name+'", успешно создан!'):this.$store.dispatch("snackbar/message",'Предмет "'+s.name+'", успешно изменен!'),this.oldName=this.data.name,e?this.$router.go(-1):(this.data=s,this.data.users||this.$set(this.data,"users",{}))}.bind(this))},load(){const e=new FormData;return e.append("f","load"),e.append("subject[id]",this.$route.params.id),this.$http.post("/ep/subject.php",e).then(function(e){this.data=e,this.oldName=this.data.name,this.data.users||this.$set(this.data,"users",{})}.bind(this))},loadTeachers(){const e=new FormData;return e.append("f","load-teachers"),this.$http.post("/ep/subject.php",e).then(function(e){this.teachers=e}.bind(this))},addTeacher(e){let t=!1,s={id:"n"+Mt++,user_id:e,name:""};this.teachers.forEach((function(t){t.value==e&&(s.name=t.text)})),Object.keys(this.data.users).forEach(function(s){t=t||this.data.users[s].user_id==e}.bind(this)),t?this.$store.dispatch("snackbar/message",'Нельзя добавить "'+s.name+'"! Уже есть!'):this.$set(this.data.users,s.id,s),this.$refs.teachers.reset()},removeTeacher(e){this.$delete(this.data.users,e)}},mounted(){this.load().finally(function(){return this.loadTeachers()}.bind(this))}},Wt=Gt,Rt=(0,F.Z)(Wt,Lt,Nt,!1,null,"41e6b28a",null),Yt=Rt.exports,Vt=function(){var e=this,t=e._self._c;return t(Ue.Z,{staticClass:"elevation-1",attrs:{dense:"",headers:e.headers,items:e.desserts,"item-key":"id",loading:e.loading,"loading-text":"Loading... Please wait"},scopedSlots:e._u([{key:"top",fn:function(){return[t(b.Z,{attrs:{flat:""}},[t(g.qW,[e._v("Предмет")]),t(h.Z,{staticClass:"mx-4",attrs:{inset:"",vertical:""}}),t(_.Z),t(r.Z,{attrs:{dark:"",color:"light-blue"},on:{click:e.load}},[e._v(" Обновить "),t(f.Z,{staticClass:"ml-2"},[e._v("mdi-reload")])],1),t(He.Z,{attrs:{"max-width":"500px"},model:{value:e.dialogDelete,callback:function(t){e.dialogDelete=t},expression:"dialogDelete"}},[t(Oe.Z,[t(Se.EB,{staticClass:"text-h5"},[e._v("Are you sure you want to delete this item?")]),t(Se.h7,[t(_.Z),t(r.Z,{attrs:{color:"blue darken-1",text:""},on:{click:e.closeDelete}},[e._v("Отмена")]),t(r.Z,{attrs:{color:"blue darken-1",text:""},on:{click:e.deleteItemConfirm}},[e._v("OK")]),t(_.Z)],1)],1)],1)],1)]},proxy:!0},{key:"item.actions",fn:function({item:s}){return[t(r.Z,{staticClass:"mr-2",attrs:{small:"",text:"",to:{name:"ep-class-edit",params:{id:s.id}}}},[t(f.Z,[e._v("mdi-pencil")])],1),t(r.Z,{attrs:{small:"",text:""},on:{click:function(t){return e.deleteItem(s)}}},[t(f.Z,[e._v("mdi-delete")])],1),e.$store.getters["authentication/isRoot"]?t(r.Z,{attrs:{small:"",text:"",to:{name:"ep-event-edit",params:{id:s.id}}}},[t(f.Z,[e._v("mdi-calendar-range")])],1):e._e()]}},{key:"footer.prepend",fn:function(){return[t(r.Z,{staticClass:"mb-2",attrs:{color:"primary",dark:"",to:{name:"ep-class-new"}}},[e._v(" Добавить "),t(f.Z,{staticClass:"ml-2"},[e._v("mdi-plus-box")])],1)]},proxy:!0}],null,!0)})},Kt=[],Qt={name:"EpClasses",data:()=>({headers:[{text:"Название",value:"name",sortable:!1},{text:"Классный руководитель",sortable:!1,value:"tutor"},{text:"Actions",value:"actions",sortable:!1}],desserts:[],loading:!0,dialogDelete:!1,editedIndex:-1,editedItem:{id:0,name:"",sort:100},defaultItem:{id:0,name:"",sort:100}}),methods:{load(){this.loading=!0;const e=new FormData;return e.append("f","list"),this.$http.post("/ep/class.php",e).then(function(e){this.desserts=e,this.loading=!1}.bind(this))},deleteItem(e){this.editedIndex=this.desserts.indexOf(e),this.editedItem=Object.assign({},e),this.dialogDelete=!0},deleteItemConfirm(){const e=new FormData;return e.append("f","remove"),e.append("id",this.editedItem.id),this.$http.post("/ep/subject.php",e).then(function(e){if(e.id===this.editedItem.id){let e=this.editedItem.name;this.$store.dispatch("snackbar/message",'Предмет "'+e+'", успешно удален!'),this.desserts.splice(this.editedIndex,1),this.closeDelete()}}.bind(this))},closeDelete(){this.dialogDelete=!1,this.$nextTick((()=>{this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1}))}},watch:{dialogDelete(e){e||this.closeDelete()}},mounted(){this.load()}},zt=Qt,Jt=(0,F.Z)(zt,Vt,Kt,!1,null,"5f7fdd56",null),Xt=Jt.exports,es=function(){var e=this,t=e._self._c;return t(lt.Z,{ref:"form"},[t(Oe.Z,{staticClass:"mx-auto"},[t(Se.EB,{staticClass:"text-h5"},[e._v(" "+e._s(e.title)+" ")]),t(Se.ZB,[t(mt.Z,{attrs:{"background-color":"primary",dark:""}},[t(ct.Z,[e._v(" Общее ")]),t(ct.Z,[e._v(" Предметы ")]),t(ut.Z,[t(Oe.Z,{attrs:{flat:""}},[t(Se.ZB,[t(Be.Z,[t(qe.Z,{attrs:{cols:"12",md:"6"}},[t("input",{attrs:{type:"hidden",name:"class[group_id]"},domProps:{value:e.data.group_id}}),t(Ne.Z,{attrs:{name:"class[name]",outlined:"",label:"Название",placeholder:"Название",rules:e.rules.name,disabled:!e.$store.getters["authentication/isRoot"]&&!e.$store.getters["authentication/isClass"]},model:{value:e.data.name,callback:function(t){e.$set(e.data,"name",t)},expression:"data.name"}}),t(Le.Z,{attrs:{name:"class[parent_id]",outlined:"",label:"Паралель",placeholder:"Паралель",items:e.parallels,disabled:!e.$store.getters["authentication/isRoot"]&&!e.$store.getters["authentication/isClass"]},model:{value:e.data.parent_id,callback:function(t){e.$set(e.data,"parent_id",t)},expression:"data.parent_id"}}),t(Le.Z,{attrs:{name:"class[user_id]",outlined:"",label:"Классный руководитель",placeholder:"Классный руководитель",items:e.tutors,disabled:!e.$store.getters["authentication/isRoot"]&&!e.$store.getters["authentication/isClass"]},model:{value:e.data.user_id,callback:function(t){e.$set(e.data,"user_id",t)},expression:"data.user_id"}})],1),t(qe.Z,{attrs:{cols:"12",md:"6"}},[t(Le.Z,{ref:"pupils",attrs:{items:e.pupils,label:"Ученики"},on:{change:e.addUser}}),t(dt.Z,{scopedSlots:e._u([{key:"default",fn:function(){return[t("tbody",e._l(e.data.users,(function(s,a){return t("tr",{key:a},[t("td",[e._v(" "+e._s(s.name)+" "),t("input",{attrs:{type:"hidden",name:"class[users]["+s.id+"][id]"},domProps:{value:s.id}}),t("input",{attrs:{type:"hidden",name:"class[users]["+s.id+"][user_id]"},domProps:{value:s.user_id}}),t("input",{attrs:{type:"hidden",name:"class[users]["+s.id+"][group_id]"},domProps:{value:s.group_id}})]),t("td",[t(r.Z,{attrs:{small:"",color:"warning",title:"Удалить"},on:{click:function(t){return e.removeUser(a)}}},[t(f.Z,[e._v(" mdi-delete ")])],1)],1)])})),0)]},proxy:!0}])})],1)],1)],1)],1)],1),t(ut.Z,[t(Oe.Z,{attrs:{flat:""}},[t(Se.ZB,[t(Le.Z,{ref:"subjects",attrs:{items:e.subjects,label:"Предметы"},on:{change:e.addSubject}}),t(Ue.Z,{attrs:{dense:"",headers:[{text:"Название",value:"name",sortable:!1},{text:"Предмет",value:"subject_id",sortable:!1},{text:"Учитель",value:"user_id",sortable:!1},{text:"Actions",value:"actions",sortable:!1}],items:e.data.sub,itemsPerPage:-1,"item-key":"id"},scopedSlots:e._u([{key:"item.name",fn:function({item:s}){return[t("input",{attrs:{type:"hidden",name:"class[sub]["+s.id+"][group_id]"},domProps:{value:s.group_id}}),e._l(s.users,(function(e,a){return t("div",{key:a},[t("input",{attrs:{type:"hidden",name:"class[sub]["+s.id+"][users]["+e.id+"][id]"},domProps:{value:e.id}}),t("input",{attrs:{type:"hidden",name:"class[sub]["+s.id+"][users]["+e.id+"][user_id]"},domProps:{value:e.user_id}}),t("input",{attrs:{type:"hidden",name:"class[sub]["+s.id+"][users]["+e.id+"][group_id]"},domProps:{value:e.group_id}})])})),t(Ne.Z,{attrs:{name:"class[sub]["+s.id+"][name]",outlined:"",label:"Название",placeholder:"Название"},model:{value:s.name,callback:function(t){e.$set(s,"name",t)},expression:"item.name"}})]}},{key:"item.subject_id",fn:function({item:s}){return[t("span",[e._v(" "+e._s(s.subject_name))]),t("input",{attrs:{type:"hidden",name:"class[sub]["+s.id+"][subject_id]"},domProps:{value:s.subject_id}})]}},{key:"item.user_id",fn:function({item:s}){return[t(Le.Z,{attrs:{name:"class[sub]["+s.id+"][user_id]",outlined:"",label:"Учитель",placeholder:"Учитель",items:e.subjectTeachers(s.subject_id)},model:{value:s.user_id,callback:function(t){e.$set(s,"user_id",t)},expression:"item.user_id"}})]}},{key:"item.actions",fn:function({index:s}){return[t(r.Z,{staticClass:"mr-2",attrs:{small:"",text:""},on:{click:function(t){return e.changeSub(s)}}},[t(f.Z,[e._v(" mdi-pencil ")])],1),t(r.Z,{attrs:{small:"",text:""},on:{click:function(t){return e.removeSubject(s)}}},[t(f.Z,[e._v(" mdi-delete ")])],1)]}}],null,!0)})],1)],1),t(He.Z,{attrs:{"max-width":"700px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[t(Oe.Z,[t(Se.EB,[t("span",{staticClass:"text-h5"},[e._v(e._s(e.editedItem.name))])]),t(Se.ZB,[t(Le.Z,{ref:"subUsers",attrs:{items:e.subUsers(),label:"Ученики"},on:{change:e.addSubUser}}),t(dt.Z,{scopedSlots:e._u([{key:"default",fn:function(){return[t("tbody",e._l(e.editedItem.users,(function(s,a){return t("tr",{key:a},[t("td",[e._v(" "+e._s(s.name)+" ")]),t("td",[t(r.Z,{attrs:{small:"",color:"warning",title:"Удалить"},on:{click:function(t){return e.removeSubUser(a)}}},[t(f.Z,[e._v(" mdi-delete ")])],1)],1)])})),0)]},proxy:!0}])})],1),t(Se.h7,[t(_.Z),t(r.Z,{attrs:{color:"blue darken-1",text:""},on:{click:function(t){e.dialog=!1}}},[e._v(" Ok ")])],1)],1)],1)],1)],1)],1),t(Se.h7,[t(r.Z,{staticClass:"mr-4",attrs:{color:"green"},on:{click:function(t){return e.save(!0)}}},[e._v(" Сохранить ")]),t(r.Z,{staticClass:"mr-4",attrs:{color:"primary"},on:{click:function(t){return e.save(!1)}}},[e._v(" Применить ")]),t(r.Z,{on:{click:function(t){return e.$router.back()}}},[e._v(" Назад ")])],1)],1)],1)},ts=[];let ss=0;var as={name:"EpClass",computed:{title(){return this.data.id?'Класс "'+this.oldName+'"':"Новый класс"}},data:()=>({dialog:!1,parallels:[],tutors:[],pupils:[],subjects:[],rules:{name:[e=>!!e||"Name is required"]},defaultItem:{id:null,name:"",subject_name:"",users:[],subject_id:null,parent_id:null,user_id:null},editedItem:{id:null,name:"",subject_name:"",users:[],subject_id:null,parent_id:null,user_id:null},data:{id:null,name:"",parent_id:null,user_id:null,users:[],sub:[]}}),methods:{save(e){const t=!this.data.id,s=new FormData(this.$refs.form.$el);return s.append("f","save"),t||s.append("class[id]",this.data.id),this.$http.post("/ep/class.php",s).then(function(s){t?this.$store.dispatch("snackbar/message",'Класс "'+s.name+'", успешно создан!'):this.$store.dispatch("snackbar/message",'Класс "'+s.name+'", успешно изменен!'),this.oldName=s.name,e?this.$router.go(-1):(this.data=s,this.data.users||this.$set(this.data,"users",[]),this.data.sub||this.$set(this.data,"sub",[]))}.bind(this))},load(){const e=new FormData;return e.append("f","load"),e.append("class[id]",this.$route.params.id),this.$http.post("/ep/class.php",e).then(function(e){this.data=e,this.oldName=this.data.name,this.data.users||this.$set(this.data,"users",[]),this.data.sub||this.$set(this.data,"sub",[])}.bind(this))},loadSubjects(){const e=new FormData;return e.append("f","load-subjects"),this.$http.post("/ep/class.php",e).then(function(e){this.subjects=e}.bind(this))},loadParallels(){const e=new FormData;return e.append("f","load-parallels"),this.$http.post("/ep/class.php",e).then(function(e){this.parallels=e}.bind(this))},loadTutors(){const e=new FormData;return e.append("f","load-tutors"),this.$http.post("/ep/class.php",e).then(function(e){this.tutors=e}.bind(this))},loadPupils(){const e=new FormData;return e.append("f","load-pupils"),this.$http.post("/ep/class.php",e).then(function(e){this.pupils=e}.bind(this))},subjectTeachers(e){for(let t=0,s=this.subjects.length;t<s;t++)if(this.subjects[t].value==e)return this.subjects[t].users;return[]},addUser(e){let t=!1,s={id:"n"+ss++,user_id:e,group_id:this.data.id,name:"",text:""};this.pupils.forEach((function(t){t.value==e&&(s.name=t.text)})),this.data.users.forEach((function(s){t=t||s.user_id==e})),t?this.$store.dispatch("snackbar/message",'Нельзя добавить "'+s.name+'"! Уже есть!'):this.data.users.push(s),this.$refs.pupils.reset()},removeUser(e){this.$delete(this.data.users,e)},addSubject(e){let t=Object.assign({},this.defaultItem);t.id="n"+ss++,t.subject_id=e,t.parent_id=this.data.id,t.users=[],this.data.users.forEach((function(e){let s=Object.assign({},e);s.id="n"+ss++,t.users.push(s)})),this.subjects.forEach(function(s){s.value==e&&(t.subject_name=s.text,t.name=this.data.name+" "+s.text)}.bind(this)),this.data.sub.push(t),this.$refs.subjects.reset()},removeSubject(e){this.$delete(this.data.sub,e)},changeSub(e){this.editedItem=this.data.sub[e],this.dialog=!0},subUsers(){let e=[];return this.data.users.forEach(function(t){e.push({value:t.user_id,text:t.name})}.bind(this)),e},addSubUser(e){let t=!1,s={id:"n"+ss++,user_id:e,name:""};this.subUsers().forEach((function(t){t.value==e&&(s.name=t.text)})),this.editedItem.users.forEach((function(s){t=t||s.user_id==e})),t?this.$store.dispatch("snackbar/message",'Нельзя добавить "'+s.name+'"! Уже есть!'):this.editedItem.users.push(s),this.$refs.subUsers.reset()},removeSubUser(e){this.$delete(this.editedItem.users,e)}},mounted(){this.loadSubjects().finally(function(){return this.loadParallels()}.bind(this)).finally(function(){return this.loadTutors()}.bind(this)).finally(function(){return this.loadPupils()}.bind(this)).finally(function(){return this.load()}.bind(this))}},ns=as,is=(0,F.Z)(ns,es,ts,!1,null,"1eb90322",null),os=is.exports,rs=s(35011),ls=s(67261),ds=function(){var e=this,t=e._self._c;return t(l.Z,{attrs:{fluid:""}},[t(ls.Z,{attrs:{height:"64"}},[t(b.Z,{attrs:{flat:""}},[t(g.qW,[e._v(e._s(e.name))]),t(_.Z),t(r.Z,{staticClass:"mr-4",attrs:{outlined:"",color:"grey darken-2"},on:{click:function(t){e.focus=""}}},[e._v(" Today ")]),t(r.Z,{attrs:{fab:"",text:"",small:"",color:"grey darken-2"},on:{click:e.prev}},[t(f.Z,{attrs:{small:""}},[e._v(" mdi-chevron-left ")])],1),t(r.Z,{attrs:{fab:"",text:"",small:"",color:"grey darken-2"},on:{click:e.next}},[t(f.Z,{attrs:{small:""}},[e._v(" mdi-chevron-right ")])],1),e.$refs.calendar?t(g.qW,[e._v(" "+e._s(e.$refs.calendar.title)+" ")]):e._e()],1)],1),t(ls.Z,{attrs:{height:"600"}},[t(rs.Z,{ref:"calendar",attrs:{"first-time":"07:00:00",color:"primary",events:e.events,"event-color":e.getEventColor,type:e.type,weekdays:e.weekdays},on:{"click:event":e.showEvent,change:e.fetchEvents},scopedSlots:e._u([{key:"day-body",fn:function({date:s,week:a}){return[t("div",{staticClass:"current-time",class:{first:s===a[0].date},style:{top:e.nowY}})]}}]),model:{value:e.focus,callback:function(t){e.focus=t},expression:"focus"}}),t(He.Z,{attrs:{activator:e.selectedElement,origin:"top center","max-width":"900"},model:{value:e.selectedOpen,callback:function(t){e.selectedOpen=t},expression:"selectedOpen"}},[t(Oe.Z,{attrs:{color:"grey lighten-4","min-width":"350px",flat:"",loading:e.loading}},[t(b.Z,{attrs:{color:e.selectedEvent.color,dark:""}},[t(g.qW,{domProps:{innerHTML:e._s(e.selectedEvent.name+" "+e.selectedEvent.fStart)}}),t(_.Z),t(r.Z,{attrs:{icon:""},on:{click:function(t){e.selectedOpen=!1}}},[t(f.Z,[e._v("mdi-close")])],1)],1),t("br"),t(Se.EB,{domProps:{innerHTML:e._s(e.selectedEvent.theme)}}),t(Se.Qq,[t(Be.Z,[t(qe.Z,{attrs:{cols:"2"}},[e._v(" Учитель: ")]),t(qe.Z,{attrs:{cols:"10"},domProps:{innerHTML:e._s(e.selectedEvent.teacher)}})],1),t(Be.Z,[t(qe.Z,{attrs:{cols:"2"}},[e._v(" Адресс почты: ")]),t(qe.Z,{attrs:{cols:"10"}},[t("a",{attrs:{href:"mailto:"+e.selectedEvent.email}},[e._v(e._s(e.selectedEvent.email))])])],1)],1),t(Se.ZB,[e.selectedEvent.ht?t("p",[t("b",[e._v("Домашнее задание:")]),t("br"),e._v(e._s(e.selectedEvent.ht))]):e._e(),e.selectedEvent.des?t("p",[t("b",[e._v("Комментарий к заданию:")]),t("br"),t("span",{domProps:{innerHTML:e._s(e.selectedEvent.des)}})]):e._e(),e.selectedEvent.pt?t("p",[t("b",[e._v("Практическое задание:")]),t("br"),e._v(e._s(e.selectedEvent.pt))]):e._e(),e.selectedEvent.net&&e.selectedEvent.net.length?[t("hr"),t("p",[t("b",[e._v("Интернет-ресурсы:")]),t("br"),e._l(e.selectedEvent.net,(function(s,a){return t("span",{key:a},[t("a",{attrs:{href:s,target:"_blank"}},[e._v(e._s(s))]),t("br")])}))],2)]:e._e(),e.selectedEvent.files?[t("hr"),e._l(e.selectedEvent.files,(function(s,a){return t("a",{key:a,attrs:{href:s,target:"_blank"}},[e._v(e._s(a))])}))]:e._e()],2)],1)],1)],1)],1)},cs=[],us={name:"EpCalendar",data:()=>({ready:!1,focus:"",name:"",type:"week",weekdays:[1,2,3,4,5,6],selectedEvent:{},selectedElement:null,selectedOpen:!1,loading:!0,events:[],colors:["blue","green","orange"]}),mounted(){this.$refs.calendar.checkChange(),this.loadInfo(),this.ready=!0,this.scrollToTime(),this.updateTime()},computed:{cal(){return this.ready?this.$refs.calendar:null},nowY(){let e=new Date;return this.cal?this.cal.timeToY({hour:e.getHours(),minute:e.getMinutes()})+"px":"-10px"}},methods:{getCurrentTime(){return this.cal?60*this.cal.times.now.hour+this.cal.times.now.minute:0},scrollToTime(){const e=this.getCurrentTime(),t=Math.max(0,e-e%30-30);this.cal.scrollToTime(t)},updateTime(){setInterval((()=>this.cal.updateTimes()),6e4)},fetchEvents({start:e,end:t}){const s=new FormData;s.append("f","load"),s.append("class_id",this.$route.params.id),s.append("start",`${e.date} 00:00:00`),s.append("end",`${t.date} 23:59:59`),this.$http.post("/event/event.php",s).then(function(e){this.events=e}.bind(this))},getEventColor(e){return e.color},prev(){this.$refs.calendar.prev()},next(){this.$refs.calendar.next()},showEvent({nativeEvent:e,event:t}){this.selectedOpen=!0,this.loading=!0,this.selectedEvent=t,this.selectedElement=e.target,this.loadDetail(this.selectedEvent.id).then(function(e){this.loading=!1,Object.assign(this.selectedEvent,e),this.selectedEvent.fStart=new Date(this.selectedEvent.start.replace(" ","T")+":00").toLocaleString()}.bind(this)),e.stopPropagation()},loadDetail(e){const t=new FormData;return t.append("f","load-detail"),t.append("id",e),this.$http.post("/event/event.php",t)},loadInfo(){const e=new FormData;return e.append("f","load-info"),e.append("class_id",this.$route.params.id),this.$http.post("/event/event.php",e).then(function(e){this.name=e.name}.bind(this))}}},ms=us,ps=(0,F.Z)(ms,ds,cs,!1,null,"459ab804",null),hs=ps.exports,fs=s(78577),vs=function(){var e=this,t=e._self._c;return t(Be.Z,{staticClass:"fill-height"},[t(qe.Z,[t(ls.Z,{attrs:{height:"64"}},[t(b.Z,{attrs:{flat:""}},[t(r.Z,{staticClass:"mr-4",attrs:{outlined:"",color:"grey darken-2"},on:{click:function(t){e.focus=""}}},[e._v(" Today ")]),t(r.Z,{attrs:{fab:"",text:"",small:"",color:"grey darken-2"},on:{click:function(t){return e.$refs.calendar.prev()}}},[t(f.Z,{attrs:{small:""}},[e._v(" mdi-chevron-left ")])],1),t(r.Z,{attrs:{fab:"",text:"",small:"",color:"grey darken-2"},on:{click:function(t){return e.$refs.calendar.next()}}},[t(f.Z,{attrs:{small:""}},[e._v(" mdi-chevron-right ")])],1),e.$refs.calendar?t(g.qW,[e._v(" "+e._s(e.$refs.calendar.title)+" ")]):e._e()],1)],1),t(ls.Z,{attrs:{height:"600"}},[t(rs.Z,{ref:"calendar",attrs:{"first-time":"07:00:00",color:"primary",events:e.events,"event-color":e.getEventColor,type:e.type,weekdays:e.weekdays},on:{"click:event":e.showEvent,change:e.fetchEvents},scopedSlots:e._u([{key:"day-body",fn:function({date:s,week:a}){return[t("div",{staticClass:"current-time",class:{first:s===a[0].date},style:{top:e.nowY}})]}}]),model:{value:e.focus,callback:function(t){e.focus=t},expression:"focus"}}),t(He.Z,{attrs:{activator:e.selectedElement,fullscreen:"","max-width":"900"},model:{value:e.selectedOpen,callback:function(t){e.selectedOpen=t},expression:"selectedOpen"}},[t(Oe.Z,{attrs:{color:"grey lighten-4","min-width":"350px",flat:"",loading:e.loading}},[t(b.Z,{attrs:{color:e.selectedEvent.color,dark:""}},[t(g.qW,[e._v(" "+e._s(e.selectedEvent.name)+" "),t(_.Z),e._v(" "+e._s(e.selectedEvent.fStart)+" ")],1),t(_.Z),t(r.Z,{attrs:{icon:""},on:{click:function(t){e.selectedOpen=!1}}},[t(f.Z,[e._v("mdi-close")])],1)],1),t(Se.ZB,[t(lt.Z,{ref:"form"},[t(l.Z,[t(Be.Z,[t(qe.Z,{attrs:{md:"6"}},[t(pt.Z,{attrs:{label:"Тема урока",placeholder:"Тема урока",name:"event[theme]",rows:"2"},model:{value:e.selectedEvent.theme,callback:function(t){e.$set(e.selectedEvent,"theme",t)},expression:"selectedEvent.theme"}})],1),t(qe.Z,{attrs:{md:"6"}},[t(pt.Z,{attrs:{label:"Практическое задание",placeholder:"Практическое задание",name:"event[pt]",rows:"2"},model:{value:e.selectedEvent.pt,callback:function(t){e.$set(e.selectedEvent,"pt",t)},expression:"selectedEvent.pt"}})],1)],1),t(Be.Z,[t(qe.Z,{attrs:{md:"6"}},[t(pt.Z,{attrs:{label:"Интернет-ресурсы",placeholder:"Интернет-ресурсы",name:"event[netResource]",rows:"2"},model:{value:e.selectedEvent.netResource,callback:function(t){e.$set(e.selectedEvent,"netResource",t)},expression:"selectedEvent.netResource"}})],1),t(qe.Z,{attrs:{md:"6"}},[t(pt.Z,{attrs:{label:"Домашнее задание",placeholder:"Домашнее задание",name:"event[ht]",rows:"2"},model:{value:e.selectedEvent.ht,callback:function(t){e.$set(e.selectedEvent,"ht",t)},expression:"selectedEvent.ht"}})],1)],1),t(Be.Z,[t(qe.Z,[t("div",{staticClass:"text-h5"},[e._v("Комментарий к заданию")]),t("ckeditor",{attrs:{editor:e.editor},model:{value:e.selectedEvent.description,callback:function(t){e.$set(e.selectedEvent,"description",t)},expression:"selectedEvent.description"}})],1)],1),t(Be.Z,[t(qe.Z,[t(fs.Z,{attrs:{name:"files[]",multiple:"",label:"Загрузить файлы"}}),t(dt.Z,{scopedSlots:e._u([{key:"default",fn:function(){return[t("tbody",e._l(e.selectedEvent.files,(function(s,a){return t("tr",{key:a},[t("td",[t("input",{attrs:{type:"hidden",name:"files[]"},domProps:{value:s.id}}),e._v(" "+e._s(s.name)+" ")]),t("td",[t(r.Z,{attrs:{color:"red"},on:{click:function(t){return e.removeFile(a,t)}}},[t(f.Z,[e._v(" mdi-close ")])],1)],1)])})),0)]},proxy:!0}])})],1)],1)],1)],1)],1),t(Se.h7,[t(r.Z,{attrs:{color:"green"},on:{click:e.save}},[e._v(" Save ")])],1)],1)],1)],1)],1)],1)},_s=[],bs=s(68299),gs=s(21233),Zs=s(79569),ks=s(87332),xs=s(78136),ys=s(12662),$s=s(62475),ws=s(72499),Es=s(9240),Is=s(35072),Cs=s(30995),Ds=s(56926),Ts=s(17300),Fs=s(43366),Ps=s(53618),js=s(57906),Os=s(39744),Ss=s(23444),As=s(48667);s(11976),s(59175),s(93641),s(2225),s(92267),s(40206),s(90858),s(54412),s(7825);
/**
 * @license Copyright (c) 2014-2022, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
class qs extends bs.Z{}qs.builtinPlugins=[gs.Z,Zs.Z,ks.Z,xs.Z,ys.Z,$s.Z,ws.Z,Es.Z,Is.Z,Cs.Z,Ds.Z,Ts.Z,Fs.Z,Ps.Z,js.Z,Os.Z,Ss.Z,As.Z],qs.defaultConfig={toolbar:{items:["undo","redo","bold","italic","underline","subscript","superscript","|","numberedList","bulletedList","alignment","|","link","|","insertTable","specialCharacters","sourceEditing"],shouldNotGroupWhenFull:!0},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]}};var Us=qs,Hs={name:"EpCalendarTeacher",data:()=>({editor:Us,ready:!1,focus:"",type:"week",weekdays:[1,2,3,4,5,6],selectedEvent:{},selectedElement:null,selectedOpen:!1,loading:!0,events:[],colors:["blue","green","orange"]}),mounted(){this.$refs.calendar.checkChange(),this.ready=!0,this.scrollToTime(),this.updateTime()},computed:{cal(){return this.ready?this.$refs.calendar:null},nowY(){let e=new Date;return this.cal?this.cal.timeToY({hour:e.getHours(),minute:e.getMinutes()})+"px":"-10px"}},methods:{getCurrentTime(){return this.cal?60*this.cal.times.now.hour+this.cal.times.now.minute:0},scrollToTime(){const e=this.getCurrentTime(),t=Math.max(0,e-e%30-30);this.cal.scrollToTime(t)},updateTime(){setInterval((()=>this.cal.updateTimes()),6e4)},fetchEvents({start:e,end:t}){const s=new FormData;s.append("f","load-teacher"),s.append("start",`${e.date}T00:00:00`),s.append("end",`${t.date}T23:59:59`),this.$http.post("/event/event.php",s).then(function(e){this.events=e}.bind(this))},getEventColor(e){return e.color},showEvent({nativeEvent:e,event:t}){this.loading=!0,this.selectedEvent=t,this.selectedElement=e.target,this.loadDetail(this.selectedEvent.id).then(function(e){this.loading=!1,this.selectedEvent=Object.assign(this.selectedEvent,e),this.selectedEvent.fStart=new Date(this.selectedEvent.start.replace(" ","T")+":00").toLocaleString(),this.selectedOpen=!0}.bind(this)),e.stopPropagation()},loadDetail(e){const t=new FormData;return t.append("f","load-teacher-detail"),t.append("id",e),this.$http.post("/event/event.php",t)},save(){const e=new FormData(this.$refs.form.$el);return e.append("f","save"),e.append("event[id]",this.selectedEvent.id),e.append("event[description]",this.selectedEvent.description),this.$http.post("/event/event.php",e).then(function(){this.selectedEvent.color=this.selectedEvent.theme?"green":"blue",this.selectedOpen=!1}.bind(this))},removeFile(e,t){this.$delete(this.selectedEvent.files,e),t.target.closest("tr").remove()}}},Bs=Hs,Ls=(0,F.Z)(Bs,vs,_s,!1,null,"a52a1938",null),Ns=Ls.exports,Ms=s(87778),Gs=s(36960),Ws=s(78480),Rs=function(){var e=this,t=e._self._c;return t(l.Z,{attrs:{fluid:""}},[t(ls.Z,{attrs:{height:"64"}},[t(b.Z,{attrs:{flat:""}},[t(g.qW,[e._v(e._s(e.name))]),t(_.Z),t(r.Z,{staticClass:"mr-4",attrs:{outlined:"",color:"grey darken-2"},on:{click:function(t){e.focus=""}}},[e._v(" Сегодня ")]),t(r.Z,{attrs:{fab:"",text:"",small:"",color:"grey darken-2"},on:{click:function(t){return e.$refs.calendar.prev()}}},[t(f.Z,{attrs:{small:""}},[e._v(" mdi-chevron-left ")])],1),t(r.Z,{attrs:{fab:"",text:"",small:"",color:"grey darken-2"},on:{click:function(t){return e.$refs.calendar.next()}}},[t(f.Z,{attrs:{small:""}},[e._v(" mdi-chevron-right ")])],1),e.$refs.calendar?t(g.qW,[e._v(" "+e._s(e.$refs.calendar.title)+" ")]):e._e()],1)],1),t(ls.Z,{attrs:{height:"600"}},[t(rs.Z,{ref:"calendar",attrs:{"first-time":"07:00:00",color:"primary",events:e.events,"event-color":e.getEventColor,type:e.type,weekdays:e.weekdays},on:{"click:event":e.showEvent,"click:time":e.newEvent,change:e.fetchEvents},scopedSlots:e._u([{key:"day-body",fn:function({date:s,week:a}){return[t("div",{staticClass:"current-time",class:{first:s===a[0].date},style:{top:e.nowY}})]}}]),model:{value:e.focus,callback:function(t){e.focus=t},expression:"focus"}}),t(He.Z,{attrs:{activator:e.selectedElement,origin:"top center","max-width":"900"},model:{value:e.selectedOpen,callback:function(t){e.selectedOpen=t},expression:"selectedOpen"}},[t(Oe.Z,{attrs:{color:"grey lighten-4","min-width":"350px",flat:"",loading:e.loading}},[t(b.Z,{attrs:{color:e.selectedEvent.color,dark:""}},[t(g.qW,{domProps:{innerHTML:e._s(e.selectedEvent.name)}}),t(_.Z),t(r.Z,{attrs:{icon:""},on:{click:function(t){e.selectedOpen=!1}}},[t(f.Z,[e._v("mdi-close")])],1)],1),t("br"),t(Se.ZB,[t(lt.Z,{ref:"form"},[t("input",{attrs:{type:"hidden",name:"event[class_id]"},domProps:{value:e.selectedEvent.class_id}}),t(Le.Z,{attrs:{name:"event[group_id]",disabled:!!e.selectedEvent.id,outlined:"",items:e.subGroups,label:"Группа"},model:{value:e.selectedEvent.group_id,callback:function(t){e.$set(e.selectedEvent,"group_id",t)},expression:"selectedEvent.group_id"}}),e.selectedEvent.id?t(Le.Z,{attrs:{name:"event[user_id]",outlined:"",items:e.teachers,label:"Учитель"},model:{value:e.selectedEvent.user_id,callback:function(t){e.$set(e.selectedEvent,"user_id",t)},expression:"selectedEvent.user_id"}}):e._e(),e.selectedEvent.id?e._e():[t(Se.Qq,[e._v("Урок")]),t(tt.Z,{ref:"times"},e._l([1,2,3,4,5,6,7,8],(function(s){return t(r.Z,{key:s,on:{click:function(t){return e.setTime(s)}}},[t(f.Z,[e._v(e._s(s))])],1)})),1)],t("v-datetime-picker",{attrs:{"text-field-props":e.textFieldProps("event[start]"),"time-picker-props":e.timePickerProps,timeFormat:"HH:mm:ss",label:"Начало",placeholder:"Начало"},model:{value:e.selectedEvent.start,callback:function(t){e.$set(e.selectedEvent,"start",t)},expression:"selectedEvent.start"}}),t("v-datetime-picker",{attrs:{"text-field-props":e.textFieldProps("event[end]"),"time-picker-props":e.timePickerProps,timeFormat:"HH:mm:ss",label:"Конец",placeholder:"Конец"},model:{value:e.selectedEvent.end,callback:function(t){e.$set(e.selectedEvent,"end",t)},expression:"selectedEvent.end"}}),t("hr"),e.selectedEvent.id?[t(Ws.Z,{attrs:{column:""},model:{value:e.selectedEvent.editType,callback:function(t){e.$set(e.selectedEvent,"editType",t)},expression:"selectedEvent.editType"}},[t(Gs.Z,{attrs:{name:"event[editType]",label:"Только это",value:"one"}}),t(Gs.Z,{attrs:{name:"event[editType]",label:"Все последущие",value:"after"}}),t(Gs.Z,{attrs:{name:"event[editType]",label:"Все",value:"all"}})],1)]:[t(He.Z,{ref:"dialog",attrs:{"return-value":e.selectedEvent.repeate,width:"290px"},on:{"update:returnValue":function(t){return e.$set(e.selectedEvent,"repeate",t)},"update:return-value":function(t){return e.$set(e.selectedEvent,"repeate",t)}},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:a}){return[t(Ne.Z,e._g(e._b({attrs:{name:"event[repeate]",label:"Повторять до",placeholder:"Повторять до","prepend-icon":"mdi-calendar",readonly:""},model:{value:e.selectedEvent.repeate,callback:function(t){e.$set(e.selectedEvent,"repeate",t)},expression:"selectedEvent.repeate"}},"v-text-field",a,!1),s))]}}]),model:{value:e.modal,callback:function(t){e.modal=t},expression:"modal"}},[t(Ms.Z,{attrs:{scrollable:""},model:{value:e.selectedEvent.repeate,callback:function(t){e.$set(e.selectedEvent,"repeate",t)},expression:"selectedEvent.repeate"}},[t(_.Z),t(r.Z,{attrs:{text:"",color:"primary"},on:{click:function(t){e.selectedEvent.repeate=null,e.$refs.dialog.save(e.selectedEvent.repeate),e.modal=!1}}},[e._v(" Clear ")]),t(r.Z,{attrs:{text:"",color:"primary"},on:{click:function(t){return e.$refs.dialog.save(e.selectedEvent.repeate)}}},[e._v(" OK ")])],1)],1)]],2)],1),t(Se.h7,[t(r.Z,{attrs:{color:"green"},on:{click:e.save}},[e._v(" Сохранить ")]),t(_.Z),e.selectedEvent.id?t(r.Z,{attrs:{color:"red"},on:{click:e.remove}},[e._v(" Удалить ")]):e._e(),t(_.Z),t(r.Z,{attrs:{text:"",color:"secondary"},on:{click:function(t){e.selectedOpen=!1}}},[e._v(" Отмена ")])],1)],1)],1)],1)],1)},Ys=[],Vs={name:"EpCalendarEditor",data:()=>({ready:!1,name:"",focus:"",type:"week",events:[],weekdays:[1,2,3,4,5,6],modal:!1,selectedEvent:{editType:"one"},teachers:[],selectedElement:null,selectedOpen:!1,loading:!0,subGroups:[],colors:["blue","green","orange"],timePickerProps:{ampmInTitle:!0,format:"24hr"},times:{1:["8:50","9:40","10:30","11:20","12:10","13:00","13:45","14:30"],def:["8:00","8:55","9:50","10:45","11:40","12:35","13:25","14:15"]}}),mounted(){this.$refs.calendar.checkChange(),this.loadInfo(),this.loadSubGroup(),this.ready=!0,this.scrollToTime(),this.updateTime()},computed:{cal(){return this.ready?this.$refs.calendar:null},nowY(){let e=new Date;return this.cal?this.cal.timeToY({hour:e.getHours(),minute:e.getMinutes()})+"px":"-10px"}},methods:{getCurrentTime(){return this.cal?60*this.cal.times.now.hour+this.cal.times.now.minute:0},scrollToTime(){const e=this.getCurrentTime(),t=Math.max(0,e-e%30-30);this.cal.scrollToTime(t)},updateTime(){setInterval((()=>this.cal.updateTimes()),6e4)},textFieldProps(e){return e=e||"",{name:e,type:"datetime"}},fetchEvents({start:e,end:t}){const s=new FormData;s.append("f","load-editor"),s.append("class_id",this.$route.params.id),s.append("start",`${e.date} 00:00:00`),s.append("end",`${t.date} 23:59:59`),this.$http.post("/event/event.php",s).then(function(e){this.events=e}.bind(this))},getEventColor(e){return e.color},showEvent({nativeEvent:e,event:t,eventParsed:s}){this.selectedOpen=!0,this.loading=!0,this.selectedEvent=t,this.selectedEvent.index=s.index,this.selectedElement=e.target,this.loadDetail(this.selectedEvent.id).then(function(e){this.loading=!1,Object.assign(this.selectedEvent,e),this.selectedEvent.editType="one",this.loadTeachers(this.selectedEvent.subject_id)}.bind(this)),e.preventDefault(),e.stopPropagation()},save(){const e=new FormData(this.$refs.form.$el);this.selectedEvent.id?(e.append("f","edit-event"),e.append("event[id]",this.selectedEvent.id)):e.append("f","add-event"),this.$http.post("/event/event.php",e).then(function(e){Object.assign(this.selectedEvent,e,{timed:!0}),this.selectedOpen=!1}.bind(this))},remove(){const e=new FormData(this.$refs.form.$el);return e.append("f","remove-event"),this.selectedEvent.id&&e.append("event[id]",this.selectedEvent.id),this.$http.post("/event/event.php",e).then(function(){let e=new Date(this.selectedEvent.start),t=new Date;e>t&&this.$delete(this.events,this.selectedEvent.index),this.selectedOpen=!1}.bind(this))},loadDetail(e){const t=new FormData;return t.append("f","load-editor-detail"),t.append("id",e),this.$http.post("/event/event.php",t)},loadTeachers(e){const t=new FormData;return t.append("f","load-teachers"),t.append("subject_id",e),this.$http.post("/event/event.php",t).then(function(e){this.teachers=e}.bind(this))},loadInfo(){const e=new FormData;return e.append("f","load-info"),e.append("class_id",this.$route.params.id),this.$http.post("/event/event.php",e).then(function(e){this.name=e.name}.bind(this))},loadSubGroup(){const e=new FormData;return e.append("class_id",this.$route.params.id),e.append("f","load-sub-groups"),this.$http.post("/event/event.php",e).then(function(e){this.subGroups=e}.bind(this))},roundTime(e,t=!0){const s=5,a=60*s*1e3;return t?e-e%a:e+(a-e%a)},newEvent(e){let t=new Date(e.year,e.month-1,e.day,e.hour,e.minute).getTime();const s=new Date(this.roundTime(t));t+=24e5;const a=new Date(this.roundTime(t));this.selectedEvent={name:`Event #${this.events.length}`,class_id:this.$route.params.id,editType:"one",color:"orange",start:s,end:a,repeate:null,timed:!0},this.selectedEvent.index=this.events.push(this.selectedEvent)-1,this.selectedOpen=!0,this.loading=!1},setTime(e){let t=(this.times[this.selectedEvent.start.getDay()]||this.times.def)[e-1].split(":"),s=new Date(this.selectedEvent.start.getFullYear(),this.selectedEvent.start.getMonth(),this.selectedEvent.start.getDate(),t[0],t[1],0).getTime();const a=new Date(this.roundTime(s));s+=24e5;const n=new Date(this.roundTime(s));this.selectedEvent.start=a,this.selectedEvent.end=n}}},Ks=Vs,Qs=(0,F.Z)(Ks,Rs,Ys,!1,null,"7353668d",null),zs=Qs.exports;a["default"].use(z.ZP);const Js=new z.ZP({mode:"history",routes:[{path:"/",name:"main",component:he},{path:"/login",name:"main-login",component:()=>s.e(607).then(s.bind(s,99607)),props:!0},{path:"/profile",name:"main-profile",component:()=>s.e(606).then(s.bind(s,36606)),props:!0,meta:{requiresAuth:!0}},{path:"/event",name:"event-layout",component:Ee,children:[{path:"",name:"ep-event-teacher",component:Ns,props:!0,meta:{requiresAuth:!0}},{path:":id",name:"ep-event",component:hs},{path:"edit/:id",name:"ep-event-edit",component:zs,meta:{requiresAuth:!0}}]},{path:"/ep",name:"ep-layout",component:Ee,meta:{requiresAuth:!0},children:[{path:"subject",name:"ep-subject-list",component:Ee,meta:{requiresAuth:!0},children:[{path:"",name:"ep-subject-list",meta:{requiresAuth:!0},component:Bt},{path:"new",name:"ep-subject-new",meta:{requiresAuth:!0},component:Yt},{path:":id",name:"ep-subject-edit",meta:{requiresAuth:!0},component:Yt}]},{path:"class",name:"ep-class-list",component:Ee,meta:{requiresAuth:!0},children:[{path:"",name:"ep-class-list",meta:{requiresAuth:!0},component:Xt},{path:"new",name:"ep-class-new",meta:{requiresAuth:!0},component:os},{path:":id",name:"ep-class-edit",meta:{requiresAuth:!0},component:os}]}]},{path:"/main",name:"main-layout",component:Ee,meta:{requiresAuth:!0},children:[{path:"",name:"main-index",component:je},{path:"ou",name:"main-ou",component:Ve},{path:"claimant",name:"main-claimant",component:et},{path:"group",name:"main-group-layout",component:Ee,children:[{path:"",name:"main-group-list",component:rt},{path:"new",name:"main-group-new",component:Zt},{path:":code",name:"main-group-edit",component:Zt}]},{path:"user",name:"main-user-layout",component:Ee,children:[{path:"",name:"main-user-list",component:It},{path:"new",name:"main-user-new",component:Ot},{path:":login",name:"main-user-edit",component:Ot}]},{path:"*/*",redirect:{name:"main-index"}}]},{path:"*",name:"notFound",component:Ze}]});Js.beforeEach(((e,t,s)=>{e.matched.some((e=>e.meta.requiresAuth))?(console.log("routed authentication"),!1!==le.getters["authentication/isAuthenticated"]?(console.log("userauthenticated: "+le.getters["authentication/isAuthenticated"]),s()):(console.log("pageuld be redirect"),s({path:"/login",query:{redirect:e.fullPath}}))):s()}));var Xs=Js,ea=s(8087),ta=s.n(ea),sa=s(52809),aa=s(69101);const na=new sa.Z({lang:{locales:{ru:aa.Z},current:"ru"}});a["default"].use(sa.Z),a["default"].use(ta(),{vuetify:na});var ia=na;ie.interceptors.response.use((function(e){return e.data}),(function(e){return 401!==e.response.status&&(le.dispatch("alert/error",e.response.data),console.log(e)),Promise.reject(e)})),a["default"].use(n.Z),a["default"].use(Q()),a["default"].config.productionTip=!1,new a["default"]({vuetify:ia,store:le,render:e=>e(V),el:"#app",router:Xs})}},t={};function s(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(i.exports,i,i.exports,s),i.loaded=!0,i.exports}s.m=e,function(){s.amdO={}}(),function(){var e=[];s.O=function(t,a,n,i){if(!a){var o=1/0;for(c=0;c<e.length;c++){a=e[c][0],n=e[c][1],i=e[c][2];for(var r=!0,l=0;l<a.length;l++)(!1&i||o>=i)&&Object.keys(s.O).every((function(e){return s.O[e](a[l])}))?a.splice(l--,1):(r=!1,i<o&&(o=i));if(r){e.splice(c--,1);var d=n();void 0!==d&&(t=d)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[a,n,i]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.f={},s.e=function(e){return Promise.all(Object.keys(s.f).reduce((function(t,a){return s.f[a](e,t),t}),[]))}}(),function(){s.u=function(e){return"js/"+e+"."+{606:"8744d8e2",607:"5efe310c"}[e]+".js"}}(),function(){s.miniCssF=function(e){}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.hmd=function(e){return e=Object.create(e),e.children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e}}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="sh67.school:";s.l=function(a,n,i,o){if(e[a])e[a].push(n);else{var r,l;if(void 0!==i)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var u=d[c];if(u.getAttribute("src")==a||u.getAttribute("data-webpack")==t+i){r=u;break}}r||(l=!0,r=document.createElement("script"),r.charset="utf-8",r.timeout=120,s.nc&&r.setAttribute("nonce",s.nc),r.setAttribute("data-webpack",t+i),r.src=a),e[a]=[n];var m=function(t,s){r.onerror=r.onload=null,clearTimeout(p);var n=e[a];if(delete e[a],r.parentNode&&r.parentNode.removeChild(r),n&&n.forEach((function(e){return e(s)})),t)return t(s)},p=setTimeout(m.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=m.bind(null,r.onerror),r.onload=m.bind(null,r.onload),l&&document.head.appendChild(r)}}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.p="/"}(),function(){var e={143:0};s.f.j=function(t,a){var n=s.o(e,t)?e[t]:void 0;if(0!==n)if(n)a.push(n[2]);else{var i=new Promise((function(s,a){n=e[t]=[s,a]}));a.push(n[2]=i);var o=s.p+s.u(t),r=new Error,l=function(a){if(s.o(e,t)&&(n=e[t],0!==n&&(e[t]=void 0),n)){var i=a&&("load"===a.type?"missing":a.type),o=a&&a.target&&a.target.src;r.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",r.name="ChunkLoadError",r.type=i,r.request=o,n[1](r)}};s.l(o,l,"chunk-"+t,t)}},s.O.j=function(t){return 0===e[t]};var t=function(t,a){var n,i,o=a[0],r=a[1],l=a[2],d=0;if(o.some((function(t){return 0!==e[t]}))){for(n in r)s.o(r,n)&&(s.m[n]=r[n]);if(l)var c=l(s)}for(t&&t(a);d<o.length;d++)i=o[d],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(c)},a=self["webpackChunksh67_school"]=self["webpackChunksh67_school"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[998],(function(){return s(39453)}));a=s.O(a)})();
//# sourceMappingURL=app.20ef7570.js.map